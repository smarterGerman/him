<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SG1 - AI German Learning System</title>
    <style>
        /* ===== BASE STYLES ===== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body, html { 
            margin: 0; 
            padding: 0; 
            height: 100%; 
            background: none; 
            overflow: hidden;
        }

        .sg1-container { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100vw; 
            height: 100vh; 
            z-index: 999999;
            background: linear-gradient(-45deg, #4ecdc4, #45b7d1, #96ceb4, #ffecd2);
            background-size: 400% 400%; 
            animation: sg1GradientShift 15s ease infinite;
            overflow: hidden; 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            display: block !important;
        }

        @keyframes sg1GradientShift { 
            0% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
            100% { background-position: 0% 50%; } 
        }

        /* ===== OVERLAYS ===== */
        .overlay-base { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            transition: opacity 1s ease-out; 
        }

        .pre-init-overlay { 
            z-index: 2000; 
            opacity: 1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .init-overlay { 
            z-index: 1000; 
            opacity: 0; 
            pointer-events: none;
            background: none !important;
            transition: opacity 0.5s ease;
        }
        
        .init-overlay.visible { 
            opacity: 1; 
            pointer-events: all;
        }
        
        .init-overlay.hidden { 
            opacity: 0; 
            pointer-events: none; 
            display: none !important;
        }

        /* ===== MUSIC INDICATOR ===== */
        .music-indicator { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            color: rgba(255, 255, 255, 0.7); 
            font-size: 14px; 
            cursor: pointer; 
            user-select: none; 
            z-index: 10000;
            transition: color 0.3s ease;
        }
        
        .music-indicator:hover { 
            color: rgba(255, 255, 255, 1); 
        }
        
        .music-indicator.off { 
            text-decoration: line-through; 
        }

        /* ===== PRE-INIT BUTTON ===== */
        .pre-init-button { 
            background: #4ecdc4; 
            color: white; 
            border: none; 
            padding: 20px 40px;
            border-radius: 15px; 
            font-size: 1.2em; 
            font-weight: 500; 
            letter-spacing: 1px; 
            cursor: pointer;
            transition: all 0.4s ease; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); 
            display: inline-block; 
        }
        
        .pre-init-button:hover { 
            background: #45b7d1; 
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); 
        }

        /* ===== LOGO ANIMATION ===== */
        .init-logo { 
            font-size: clamp(5em, 20vw, 7.5em); 
            font-weight: 100; 
            color: white; 
            letter-spacing: 3px;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            opacity: 0;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        @keyframes sg1LogoFade {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            35% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            75% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
        }

        /* ===== DNA VISUALIZER ===== */
        .voice-visualizer { 
            height: 120px; 
            width: min(450px, 85vw); 
            position: absolute;
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            display: flex; 
            align-items: center; 
            justify-content: center; 
            opacity: 0;
            cursor: pointer;
            transition: all 0.6s ease;
        }

        .dna-container { 
            display: flex; 
            align-items: center; 
            justify-content: center;
            z-index: 1; 
            position: relative; 
            width: min(400px, 80vw); 
            height: 80px;
            transform-style: preserve-3d; 
            perspective: 1000px;
        }

        /* DNA Strands */
        .dna-strand { 
            fill: none; 
            stroke: white; 
            stroke-width: 5; 
            stroke-linecap: round;
            animation: sg1DNAFlow 5s linear infinite;
            transform-origin: 50% 50%;
            filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.3));
            opacity: 1;
            transition: opacity 0.8s ease;
        }
        
        .dna-strand:nth-child(2) { 
            animation-delay: 0.5s;
            filter: drop-shadow(1px 1px 3px rgba(0, 0, 0, 0.35));
        }
        
        .dna-strand:nth-child(3) { 
            animation-delay: 1s;
            filter: drop-shadow(1px 1px 4px rgba(0, 0, 0, 0.4));
        }

        @keyframes sg1DNAFlow {
            0% { transform: rotateX(0deg); }
            100% { transform: rotateX(360deg); }
        }

        /* Fast speaking animations */
        @keyframes sg1DNAFlowFast1 {
            0% { transform: rotateX(0deg); }
            20% { transform: rotateX(120deg); }
            40% { transform: rotateX(180deg); }
            70% { transform: rotateX(300deg); }
            100% { transform: rotateX(360deg); }
        }
        
        @keyframes sg1DNAFlowFast2 {
            0% { transform: rotateX(0deg); }
            30% { transform: rotateX(90deg); }
            50% { transform: rotateX(240deg); }
            80% { transform: rotateX(300deg); }
            100% { transform: rotateX(360deg); }
        }
        
        @keyframes sg1DNAFlowFast3 {
            0% { transform: rotateX(0deg); }
            15% { transform: rotateX(150deg); }
            60% { transform: rotateX(210deg); }
            85% { transform: rotateX(330deg); }
            100% { transform: rotateX(360deg); }
        }

        .speaking .dna-strand { 
            stroke-width: 6; 
        }
        
        .speaking .dna-strand:nth-child(1) { 
            animation: sg1DNAFlowFast1 0.7s ease-in-out infinite; 
        }
        
        .speaking .dna-strand:nth-child(2) { 
            animation: sg1DNAFlowFast2 0.5s ease-in-out infinite; 
        }
        
        .speaking .dna-strand:nth-child(3) { 
            animation: sg1DNAFlowFast3 0.6s ease-in-out infinite; 
        }

        .listening .dna-strand { 
            animation: sg1DNAFlow 2s linear infinite;
            stroke: #ffd54f;
            filter: drop-shadow(1px 1px 3px rgba(255, 213, 79, 0.4));
        }

        /* ===== DNA TEXT BUTTON ===== */
        .dna-text-button {
            position: absolute;
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.95);
            font-size: clamp(20px, 5vw, 28px);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-weight: 200;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            opacity: 0;
            pointer-events: none;
            transition: all 0.8s ease;
            cursor: pointer;
            z-index: 10;
            white-space: nowrap;
        }

        .dna-text-button.visible {
            opacity: 1;
            pointer-events: all;
        }

        .dna-text-button:hover {
            color: rgba(255, 255, 255, 1);
            transform: translate(-50%, -50%) translateY(-3px);
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
        }

        /* DNA state when showing text */
        .voice-visualizer.text-mode .dna-strand {
            opacity: 0;
        }

        .voice-visualizer.text-mode .dna-text-button {
            opacity: 1;
            pointer-events: all;
        }

        /* Answer choices container */
        .answer-choices-container {
            position: absolute;
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.8s ease;
            z-index: 10;
        }

        .answer-choices-container.visible {
            opacity: 1;
            pointer-events: all;
        }

        .answer-choice {
            color: rgba(255, 255, 255, 0.95);
            font-size: clamp(16px, 4vw, 18px);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-weight: 200;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            cursor: pointer;
            padding: 15px 30px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s ease;
            text-align: center;
            min-width: 350px;
            max-width: 450px;
            position: relative;
            white-space: nowrap;
            margin: 8px 0;
        }

        .answer-choice:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            color: rgba(255, 255, 255, 1);
        }

        .answer-translation {
            font-size: 14px;
            opacity: 0;
            font-style: italic;
            margin-top: 8px;
            transition: opacity 0.3s ease;
            pointer-events: none;
            white-space: normal;
        }

        .answer-choice:hover .answer-translation {
            opacity: 0.8;
        }

        /* Text input field for goal and mother questions */
        .text-input-container {
            position: absolute;
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.8s ease;
            z-index: 10;
            width: min(500px, 90vw);
        }

        .text-input-container.visible {
            opacity: 1;
            pointer-events: all;
        }

        .text-input-field {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 15px 25px;
            color: white;
            font-size: clamp(16px, 4vw, 18px);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-weight: 200;
            letter-spacing: 1px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            outline: none;
        }

        .text-input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
        }

        .text-input-field:focus {
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.02);
        }

        .text-submit-button {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 12px 30px;
            color: rgba(255, 255, 255, 0.95);
            font-size: clamp(14px, 3.5vw, 16px);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-weight: 200;
            letter-spacing: 1px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            min-width: 120px;
        }

        .text-submit-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .time-probability-container {
            position: absolute;
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 20px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.8s ease;
            z-index: 10;
            flex-wrap: wrap;
            justify-content: center;
        }

        .time-probability-container.visible {
            opacity: 1;
            pointer-events: all;
        }

        .time-choice, .probability-choice {
            color: rgba(255, 255, 255, 0.95);
            font-size: clamp(16px, 4vw, 20px);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-weight: 200;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            cursor: pointer;
            padding: 15px 25px;
            border-radius: 25px;
            background: transparent;
            transition: all 0.4s ease;
        }

        .time-choice:hover, .probability-choice:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            color: rgba(255, 255, 255, 1);
        }

        /* ===== PROGRESS BAR ===== */
        .progress-container { 
            position: absolute; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%);
            width: min(400px, 80vw); 
            height: 4px; 
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px; 
            overflow: hidden; 
            z-index: 50;
        }
        
        .progress-bar { 
            height: 100%; 
            background: linear-gradient(90deg, #4ecdc4, #45b7d1);
            width: 0%; 
            transition: width 1s ease; 
            border-radius: 2px;
        }

        .hidden { 
            opacity: 0 !important; 
            pointer-events: none !important; 
        }
        
        .visible { 
            opacity: 1 !important; 
            pointer-events: all !important; 
        }
        
        .active { 
            display: flex !important; 
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .answer-choice {
                min-width: 320px;
                max-width: 90vw;
                font-size: 16px;
                padding: 18px 25px;
                white-space: normal;
            }

            .time-probability-container {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 15px;
                justify-content: center;
                max-width: 90vw;
            }

            .time-choice, .probability-choice {
                min-width: 80px;
                text-align: center;
                flex: 0 0 auto;
            }

            #scaleChoicesContainer, #motherScaleChoicesContainer {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                gap: 10px;
                max-width: 350px;
            }

            #scaleChoicesContainer .probability-choice,
            #motherScaleChoicesContainer .probability-choice {
                min-width: 50px;
                padding: 12px 8px;
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .answer-choice {
                min-width: 280px;
                font-size: 15px;
                white-space: normal;
            }

            #scaleChoicesContainer, #motherScaleChoicesContainer {
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
                max-width: 300px;
            }
        }

        @media (min-width: 769px) {
            #scaleChoicesContainer, #motherScaleChoicesContainer {
                display: grid;
                grid-template-columns: repeat(10, 1fr);
                gap: 10px;
                max-width: 600px;
            }

            #scaleChoicesContainer .probability-choice,
            #motherScaleChoicesContainer .probability-choice {
                min-width: 50px;
                aspect-ratio: 1;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="sg1-container">
        <!-- Music indicator -->
        <div class="music-indicator" id="musicIndicator" onclick="SG1.toggleMusic()">music</div>

        <div class="pre-init-overlay overlay-base" id="preInitOverlay">
            <button class="pre-init-button" onclick="SG1.beginInitialization()">Initiate AI</button>
        </div>

        <div class="init-overlay overlay-base" id="initOverlay">
            <div class="init-logo">SG1</div>
            <div style="position: absolute; bottom: 100px; color: white; font-size: 16px; opacity: 0.8;" id="statusText">Initializing audio system...</div>
        </div>

        <div class="voice-visualizer" id="visualizer" onclick="DNAButton.handleClick()">
            <div class="dna-container">
                <svg width="100%" height="80" viewBox="0 0 400 80">
                    <path class="dna-strand" d="M0,40 Q50,15 100,40 Q150,65 200,40 Q250,15 300,40 Q350,65 400,40" />
                    <path class="dna-strand" d="M0,40 Q50,65 100,40 Q150,15 200,40 Q250,65 300,40 Q350,15 400,40" />
                    <path class="dna-strand" d="M0,40 Q50,15 100,40 Q150,65 200,40 Q250,15 300,40 Q350,65 400,40" />
                </svg>
                
                <!-- Text button overlay -->
                <div class="dna-text-button" id="dnaTextButton"></div>
                
                <!-- Answer choices for question 1 -->
                <div class="answer-choices-container" id="answerChoicesContainer">
                    <div class="answer-choice" onclick="DNAButton.handleAnswerChoice(0)">
                        Gute Frage
                        <div class="answer-translation">Good question</div>
                    </div>
                    <div class="answer-choice" onclick="DNAButton.handleAnswerChoice(1)">
                        Nächste Frage
                        <div class="answer-translation">Next question</div>
                    </div>
                    <div class="answer-choice" onclick="DNAButton.handleAnswerChoice(2)">
                        Keine Ahnung
                        <div class="answer-translation">No idea</div>
                    </div>
                    <div class="answer-choice" onclick="DNAButton.handleAnswerChoice(3)">
                        Das geht Dich gar nichts an
                        <div class="answer-translation">That's none of your business</div>
                    </div>
                </div>

                <!-- Text input for goal question -->
                <div class="text-input-container" id="goalInputContainer">
                    <input type="text" class="text-input-field" id="goalInput" placeholder="Type your goal here..." maxlength="200" onkeypress="if(event.key==='Enter') DNAButton.handleGoalSubmit()">
                    <button class="text-submit-button" onclick="DNAButton.handleGoalSubmit()">Submit</button>
                </div>

                <!-- Text input for mother question -->
                <div class="text-input-container" id="motherInputContainer">
                    <input type="text" class="text-input-field" id="motherInput" placeholder="Describe your relationship..." maxlength="200" onkeypress="if(event.key==='Enter') DNAButton.handleMotherSubmit()">
                    <button class="text-submit-button" onclick="DNAButton.handleMotherSubmit()">Submit</button>
                </div>

                <!-- Time commitment choices -->
                <div class="time-probability-container" id="timeChoicesContainer">
                    <div class="time-choice" onclick="DNAButton.handleTimeChoice(0)">1 hours per week</div>
                    <div class="time-choice" onclick="DNAButton.handleTimeChoice(1)">5 hours per week</div>
                    <div class="time-choice" onclick="DNAButton.handleTimeChoice(2)">15 hours per week</div>
                </div>

                <!-- Probability choices -->
                <div class="time-probability-container" id="probabilityChoicesContainer">
                    <div class="probability-choice" onclick="DNAButton.handleProbabilityChoice('low')">&lt;50%</div>
                    <div class="probability-choice" onclick="DNAButton.handleProbabilityChoice('medium')">80%</div>
                    <div class="probability-choice" onclick="DNAButton.handleProbabilityChoice('high')">100%</div>
                </div>

                <!-- Scale 1-10 choices -->
                <div class="time-probability-container" id="scaleChoicesContainer">
                    <div class="probability-choice" onclick="DNAButton.handleScaleChoice(1)">1</div>
                    <div class="probability-choice" onclick="DNAButton.handleScaleChoice(2)">2</div>
                    <div class="probability-choice" onclick="DNAButton.handleScaleChoice(3)">3</div>
                    <div class="probability-choice" onclick="DNAButton.handleScaleChoice(4)">4</div>
                    <div class="probability-choice" onclick="DNAButton.handleScaleChoice(5)">5</div>
                    <div class="probability-choice" onclick="DNAButton.handleScaleChoice(6)">6</div>
                    <div class="probability-choice" onclick="DNAButton.handleScaleChoice(7)">7</div>
                    <div class="probability-choice" onclick="DNAButton.handleScaleChoice(8)">8</div>
                    <div class="probability-choice" onclick="DNAButton.handleScaleChoice(9)">9</div>
                    <div class="probability-choice" onclick="DNAButton.handleScaleChoice(10)">10</div>
                </div>

                <!-- Food choices -->
                <div class="answer-choices-container" id="foodChoicesContainer">
                    <div class="answer-choice" onclick="DNAButton.handleFoodChoice(0)">
                        Kartoffelpuffer
                        <div class="answer-translation">Potato pancakes</div>
                    </div>
                    <div class="answer-choice" onclick="DNAButton.handleFoodChoice(1)">
                        Currywurst
                        <div class="answer-translation">Curry sausage</div>
                    </div>
                    <div class="answer-choice" onclick="DNAButton.handleFoodChoice(2)">
                        Döner
                        <div class="answer-translation">Döner kebab</div>
                    </div>
                </div>

                <!-- German person choices -->
                <div class="answer-choices-container" id="germanChoicesContainer">
                    <div class="answer-choice" onclick="DNAButton.handleGermanChoice(0)">Adolf Hitler</div>
                    <div class="answer-choice" onclick="DNAButton.handleGermanChoice(1)">Arnold Schwarzenegger</div>
                    <div class="answer-choice" onclick="DNAButton.handleGermanChoice(2)">Angela Merkel</div>
                </div>

                <!-- Call frequency choices -->
                <div class="answer-choices-container" id="callChoicesContainer">
                    <div class="answer-choice" onclick="DNAButton.handleCallChoice(0)">Once per day</div>
                    <div class="answer-choice" onclick="DNAButton.handleCallChoice(1)">Once per week</div>
                    <div class="answer-choice" onclick="DNAButton.handleCallChoice(2)">Once per year or less</div>
                </div>

                <!-- Scale 1-10 choices for mother question -->
                <div class="time-probability-container" id="motherScaleChoicesContainer">
                    <div class="probability-choice" onclick="DNAButton.handleMotherScaleChoice(1)">1</div>
                    <div class="probability-choice" onclick="DNAButton.handleMotherScaleChoice(2)">2</div>
                    <div class="probability-choice" onclick="DNAButton.handleMotherScaleChoice(3)">3</div>
                    <div class="probability-choice" onclick="DNAButton.handleMotherScaleChoice(4)">4</div>
                    <div class="probability-choice" onclick="DNAButton.handleMotherScaleChoice(5)">5</div>
                    <div class="probability-choice" onclick="DNAButton.handleMotherScaleChoice(6)">6</div>
                    <div class="probability-choice" onclick="DNAButton.handleMotherScaleChoice(7)">7</div>
                    <div class="probability-choice" onclick="DNAButton.handleMotherScaleChoice(8)">8</div>
                    <div class="probability-choice" onclick="DNAButton.handleMotherScaleChoice(9)">9</div>
                    <div class="probability-choice" onclick="DNAButton.handleMotherScaleChoice(10)">10</div>
                </div>

                <!-- AI type choices -->
                <div class="answer-choices-container" id="aiChoicesContainer">
                    <div class="answer-choice" onclick="DNAButton.handleAIChoice('male')">Male</div>
                    <div class="answer-choice" onclick="DNAButton.handleAIChoice('female')">Female</div>
                    <div class="answer-choice" onclick="DNAButton.handleAIChoice('diverse')">Diverse</div>
                </div>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- Background music -->
        <audio id="backgroundMusic" loop preload="auto">
            <source src="https://uploads.teachablecdn.com/attachments/bf581168d687477abe77c3052ae7782f.mp3" type="audio/mpeg">
        </audio>
    </div>

<script>
        var State = {
            step: 0,
            isSpeaking: false,
            motherInterruptTimer: null,
            inFinalSequence: false,
            audioUnlocked: false,
            mobileAudioStarted: false,
            holdingTimer: null,
            selectedAIType: null,
            
            audioFiles: {
                0: 'https://uploads.teachablecdn.com/attachments/3623b7eb37e640b2946b7f07b730dff7.mp3',
                1: 'https://uploads.teachablecdn.com/attachments/9cc7908384fd49c58242394eadc70273.mp3',
                2: 'https://uploads.teachablecdn.com/attachments/fc2c86bf325b410797aa9a99af512c37.mp3',
                3: 'https://uploads.teachablecdn.com/attachments/3ac16fa084c24c36aa0dfd5373cdb9e8.mp3',
                4: 'https://uploads.teachablecdn.com/attachments/a50b18aaab3048598be4786a359612d6.m4a',
                5: 'https://uploads.teachablecdn.com/attachments/ba1fd841f66b485d8ecd6f17a94edb80.mp3',
                6: 'https://uploads.teachablecdn.com/attachments/3241a2f7d8e447469e9d3e038afdbf07.mp3',
                7: 'https://uploads.teachablecdn.com/attachments/60c3a446d2b24be38dc14fe88be58f53.mp3',
                8: 'https://uploads.teachablecdn.com/attachments/d72b2fb1573f4b73bfa8552d21e99e40.mp3',
                9: 'https://uploads.teachablecdn.com/attachments/ac0aa8c556c74c13ba1a451c83baa18d.mp3',
                10: 'https://uploads.teachablecdn.com/attachments/3886fdb12b16415f89ff5fbe1e4114f0.mp3',
                11: 'https://uploads.teachablecdn.com/attachments/6af1fcc67d71404fb415c19f720f00af.mp3',
                12: 'https://uploads.teachablecdn.com/attachments/16e62c9df320432f92574d0f945c7fe8.mp3',
                13: 'https://uploads.teachablecdn.com/attachments/e380c0630dbd43ec83b27aad05227c4d.mp3',
                14: 'https://uploads.teachablecdn.com/attachments/d61b86f90652471181352a77c5dbe7ec.mp3',
                15: 'https://uploads.teachablecdn.com/attachments/20c0c1906b8345a48d319c7c08abe0aa.mp3',
                16: 'https://uploads.teachablecdn.com/attachments/a02dd5d73da4499dbe9f26cca03a6039.mp3',
                17: 'https://uploads.teachablecdn.com/attachments/4dd1dee1debe48349289dc68edb76a00.mp3'
            },
            
            thankYouAudio: 'https://uploads.teachablecdn.com/attachments/e45836cb3b024909ae5d8d9d6ae3f22c.mp3',
            confirmationSound: 'https://uploads.teachablecdn.com/attachments/ebf39ab0ba784db195ca54196bae8784.mp3'
        };

        var UI = {
            element: function(id) { 
                return document.getElementById(id); 
            },
            
            showElement: function(id) { 
                var element = this.element(id);
                if (element) {
                    element.classList.remove('hidden');
                    element.classList.add('active', 'visible');
                    element.style.display = 'flex';
                    if (id === 'visualizer') {
                        element.style.opacity = '1';
                    }
                }
            },
            
            hideElement: function(id) { 
                var element = this.element(id);
                if (element) {
                    element.classList.remove('active', 'visible');
                    element.classList.add('hidden');
                }
            },
            
            setVisualizerState: function(state) { 
                var visualizer = this.element('visualizer');
                if (visualizer) {
                    visualizer.className = 'voice-visualizer active ' + state;
                }
            },
            
            updateProgress: function(percentage) {
                var bar = this.element('progressBar');
                if (bar) bar.style.width = percentage + '%';
            }
        };

        var DNAButton = {
            currentMode: 'dna',
            
            playConfirmationSound: function() {
                try {
                    var confirmAudio = new Audio(State.confirmationSound);
                    confirmAudio.volume = 0.7;
                    confirmAudio.play().catch(function(e) {
                        console.log('Confirmation sound failed:', e.message);
                    });
                } catch (e) {
                    console.log('Confirmation sound error:', e.message);
                }
            },
            
            showText: function(text) {
                var visualizer = UI.element('visualizer');
                var textButton = UI.element('dnaTextButton');
                
                if (textButton && visualizer) {
                    textButton.style.transition = 'all 0.8s ease';
                    textButton.style.opacity = '0';
                    textButton.style.transform = 'translate(-50%, -50%)';
                    
                    textButton.textContent = text;
                    visualizer.classList.add('text-mode');
                    
                    setTimeout(function() {
                        textButton.classList.add('visible');
                        textButton.style.opacity = '1';
                    }, 50);
                    
                    this.currentMode = 'text';
                }
            },
            
            hideTex: function() {
                var visualizer = UI.element('visualizer');
                var textButton = UI.element('dnaTextButton');
                
                if (textButton && visualizer) {
                    visualizer.classList.remove('text-mode');
                    textButton.classList.remove('visible');
                    this.currentMode = 'dna';
                }
            },

            showAnswerChoices: function() {
                var visualizer = UI.element('visualizer');
                var choicesContainer = UI.element('answerChoicesContainer');
                
                if (choicesContainer && visualizer) {
                    visualizer.classList.add('text-mode');
                    choicesContainer.classList.add('visible');
                    this.currentMode = 'choices';
                }
            },

            showTimeChoices: function() {
                var visualizer = UI.element('visualizer');
                var timeContainer = UI.element('timeChoicesContainer');
                
                if (timeContainer && visualizer) {
                    visualizer.classList.add('text-mode');
                    timeContainer.classList.add('visible');
                    this.currentMode = 'time';
                }
            },

            showProbabilityChoices: function() {
                var visualizer = UI.element('visualizer');
                var probContainer = UI.element('probabilityChoicesContainer');
                
                if (probContainer && visualizer) {
                    visualizer.classList.add('text-mode');
                    probContainer.classList.add('visible');
                    this.currentMode = 'probability';
                }
            },

            showGoalInput: function() {
                var visualizer = UI.element('visualizer');
                var goalContainer = UI.element('goalInputContainer');
                
                if (goalContainer && visualizer) {
                    visualizer.classList.add('text-mode');
                    goalContainer.classList.add('visible');
                    this.currentMode = 'goal-input';
                    
                    setTimeout(function() {
                        var goalInput = UI.element('goalInput');
                        if (goalInput) goalInput.focus();
                    }, 300);
                }
            },

            showMotherInput: function() {
                var visualizer = UI.element('visualizer');
                var motherContainer = UI.element('motherInputContainer');
                
                if (motherContainer && visualizer) {
                    visualizer.classList.add('text-mode');
                    motherContainer.classList.add('visible');
                    this.currentMode = 'mother-input';
                    
                    setTimeout(function() {
                        var motherInput = UI.element('motherInput');
                        if (motherInput) motherInput.focus();
                    }, 300);
                }
            },

            showScaleChoices: function() {
                var visualizer = UI.element('visualizer');
                var scaleContainer = UI.element('scaleChoicesContainer');
                
                if (scaleContainer && visualizer) {
                    visualizer.classList.add('text-mode');
                    scaleContainer.classList.add('visible');
                    this.currentMode = 'scale';
                }
            },

            showFoodChoices: function() {
                var visualizer = UI.element('visualizer');
                var foodContainer = UI.element('foodChoicesContainer');
                
                if (foodContainer && visualizer) {
                    visualizer.classList.add('text-mode');
                    foodContainer.classList.add('visible');
                    this.currentMode = 'food';
                }
            },

            showGermanChoices: function() {
                var visualizer = UI.element('visualizer');
                var germanContainer = UI.element('germanChoicesContainer');
                
                if (germanContainer && visualizer) {
                    visualizer.classList.add('text-mode');
                    germanContainer.classList.add('visible');
                    this.currentMode = 'german';
                }
            },

            showCallChoices: function() {
                var visualizer = UI.element('visualizer');
                var callContainer = UI.element('callChoicesContainer');
                
                if (callContainer && visualizer) {
                    visualizer.classList.add('text-mode');
                    callContainer.classList.add('visible');
                    this.currentMode = 'call';
                }
            },

            showMotherScaleChoices: function() {
                var visualizer = UI.element('visualizer');
                var motherScaleContainer = UI.element('motherScaleChoicesContainer');
                
                if (motherScaleContainer && visualizer) {
                    visualizer.classList.add('text-mode');
                    motherScaleContainer.classList.add('visible');
                    this.currentMode = 'mother-scale';
                }
            },

            showAIChoices: function() {
                var visualizer = UI.element('visualizer');
                var aiContainer = UI.element('aiChoicesContainer');
                
                if (aiContainer && visualizer) {
                    visualizer.classList.add('text-mode');
                    aiContainer.classList.add('visible');
                    this.currentMode = 'ai';
                }
            },
            
            showDNA: function() {
                var visualizer = UI.element('visualizer');
                var textButton = UI.element('dnaTextButton');
                var choicesContainer = UI.element('answerChoicesContainer');
                var timeContainer = UI.element('timeChoicesContainer');
                var probContainer = UI.element('probabilityChoicesContainer');
                var goalContainer = UI.element('goalInputContainer');
                var motherContainer = UI.element('motherInputContainer');
                var scaleContainer = UI.element('scaleChoicesContainer');
                var foodContainer = UI.element('foodChoicesContainer');
                var germanContainer = UI.element('germanChoicesContainer');
                var callContainer = UI.element('callChoicesContainer');
                var motherScaleContainer = UI.element('motherScaleChoicesContainer');
                var aiContainer = UI.element('aiChoicesContainer');
                
                if (visualizer) {
                    visualizer.classList.remove('text-mode');
                    if (textButton) textButton.classList.remove('visible');
                    if (choicesContainer) choicesContainer.classList.remove('visible');
                    if (timeContainer) timeContainer.classList.remove('visible');
                    if (probContainer) probContainer.classList.remove('visible');
                    if (goalContainer) goalContainer.classList.remove('visible');
                    if (motherContainer) motherContainer.classList.remove('visible');
                    if (scaleContainer) scaleContainer.classList.remove('visible');
                    if (foodContainer) foodContainer.classList.remove('visible');
                    if (germanContainer) germanContainer.classList.remove('visible');
                    if (callContainer) callContainer.classList.remove('visible');
                    if (motherScaleContainer) motherScaleContainer.classList.remove('visible');
                    if (aiContainer) aiContainer.classList.remove('visible');
                    this.currentMode = 'dna';
                }
            },
            
            handleClick: function() {
                if (this.currentMode !== 'text') return;
                
                switch(State.step) {
                    case 0:
                        this.handleBereit();
                        break;
                    case 2:
                    case 5:
                    case 7:
                        this.handleDummy();
                        break;
                    case 6:
                        this.handleJa();
                        break;
                    case 8:
                        this.handleNaGut();
                        break;
                }
            },

            handleAnswerChoice: function(choiceIndex) {
                if (this.currentMode !== 'choices') return;
                
                this.playConfirmationSound();
                this.animateChoiceClick();
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    Conversation.moveToNextQuestion();
                }, 800);
            },

            handleTimeChoice: function(choiceIndex) {
                if (this.currentMode !== 'time') return;
                
                this.playConfirmationSound();
                this.animateChoiceClick();
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    Conversation.moveToNextQuestion();
                }, 800);
            },

            handleProbabilityChoice: function(level) {
                if (this.currentMode !== 'probability') return;
                
                this.playConfirmationSound();
                this.animateChoiceClick();
                
                if (level === 'low') {
                    setTimeout(function() {
                        window.open('https://smartergerman.com/courses/unblock-your-german/', '_blank');
                        DNAButton.showDNA();
                        Conversation.moveToNextQuestion();
                    }, 800);
                } else {
                    setTimeout(function() {
                        DNAButton.showDNA();
                        Conversation.moveToNextQuestion();
                    }, 800);
                }
            },
            
            animateClick: function() {
                var textButton = UI.element('dnaTextButton');
                if (textButton) {
                    textButton.style.transform = 'translate(-50%, -50%) scale(0.95)';
                    textButton.style.opacity = '0.7';
                    
                    setTimeout(function() {
                        textButton.style.transform = 'translate(-50%, -50%) scale(1)';
                        textButton.style.opacity = '1';
                    }, 200);
                }
            },

            animateChoiceClick: function() {
                var containers = ['answerChoicesContainer', 'timeChoicesContainer', 'probabilityChoicesContainer'];
                containers.forEach(function(id) {
                    var container = UI.element(id);
                    if (container && container.classList.contains('visible')) {
                        container.style.opacity = '0';
                        container.style.transform = 'translate(-50%, -50%) translateY(10px)';
                    }
                });
            },
            
            handleBereit: function() {
                this.playConfirmationSound();
                
                var textButton = UI.element('dnaTextButton');
                if (textButton) {
                    textButton.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
                    textButton.style.opacity = '0';
                    textButton.style.transform = 'translate(-50%, -50%) translateY(10px)';
                }
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    setTimeout(function() {
                        Conversation.moveToNextQuestion();
                    }, 200);
                }, 800);
            },
            
            handleDummy: function() {
                this.playConfirmationSound();
                
                var textButton = UI.element('dnaTextButton');
                if (textButton) {
                    textButton.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
                    textButton.style.opacity = '0';
                    textButton.style.transform = 'translate(-50%, -50%) translateY(10px)';
                }
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    setTimeout(function() {
                        if (State.step === 5) {
                            Conversation.moveToNextQuestion();
                        } else {
                            Conversation.playThankYou();
                        }
                    }, 200);
                }, 800);
            },
            
            handleJa: function() {
                var textButton = UI.element('dnaTextButton');
                if (textButton) {
                    textButton.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
                    textButton.style.opacity = '0';
                    textButton.style.transform = 'translate(-50%, -50%) translateY(10px)';
                }
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    setTimeout(function() {
                        Conversation.moveToNextQuestion();
                    }, 200);
                }, 800);
            },
            
            handleNaGut: function() {
                var textButton = UI.element('dnaTextButton');
                if (textButton) {
                    textButton.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
                    textButton.style.opacity = '0';
                    textButton.style.transform = 'translate(-50%, -50%) translateY(10px)';
                }
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    setTimeout(function() {
                        Conversation.completeCourse();
                    }, 200);
                }, 800);
            },

            handleGoalSubmit: function() {
                var goalInput = UI.element('goalInput');
                var goalValue = goalInput ? goalInput.value.trim() : '';
                
                this.playConfirmationSound();
                
                if (goalValue) {
                    this.submitToGoogleForm(goalValue, 'goal');
                }
                
                this.animateInputContainerOut('goalInputContainer');
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    Conversation.playThankYou();
                }, 800);
            },

            handleMotherSubmit: function() {
                var motherInput = UI.element('motherInput');
                var motherValue = motherInput ? motherInput.value.trim() : '';
                
                this.playConfirmationSound();
                
                if (motherValue) {
                    this.submitToGoogleForm(motherValue, 'mother');
                }
                
                this.animateInputContainerOut('motherInputContainer');
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    Conversation.moveToNextQuestion();
                }, 800);
            },

            submitToGoogleForm: function(value, type) {
                try {
                    var baseUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSc-hRZpWi9wo0j9xMtrAStg1ivm_i420KNFFEY5qoeP1zUFVQ/formResponse';
                    var fieldName = type === 'goal' ? 'entry.1685277614' : 'entry.745882257';
                    
                    var params = new URLSearchParams();
                    params.append(fieldName, value);
                    params.append('submit', 'Submit');
                    
                    fetch(baseUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: params.toString()
                    }).then(function() {
                        console.log('✅ SUBMITTED TO GOOGLE SHEET:', type);
                    }).catch(function(e) {
                        console.log('❌ SUBMISSION ERROR:', e.message);
                    });
                    
                } catch (e) {
                    console.log('❌ GOOGLE SHEET SUBMISSION ERROR:', e.message);
                }
            },

            animateInputContainerOut: function(containerId) {
                var container = UI.element(containerId);
                if (container) {
                    container.style.opacity = '0';
                    container.style.transform = 'translate(-50%, -50%) translateY(10px)';
                }
            },

            handleScaleChoice: function(rating) {
                this.playConfirmationSound();
                this.animateChoiceClick();
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    Conversation.playThankYou();
                }, 800);
            },

            handleFoodChoice: function(choiceIndex) {
                this.playConfirmationSound();
                this.animateChoiceClick();
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    Conversation.playThankYou();
                }, 800);
            },

            handleGermanChoice: function(choiceIndex) {
                this.playConfirmationSound();
                this.animateChoiceClick();
                
                // Special redirections based on choice
                if (choiceIndex === 0) { // Hitler
                    setTimeout(function() {
                        window.open('https://encyclopedia.ushmm.org/content/en/film/scenes-from-the-liberation-of-buchenwald', '_blank');
                        DNAButton.showDNA();
                        Conversation.playThankYou();
                    }, 800);
                } else if (choiceIndex === 1) { // Schwarzenegger
                    setTimeout(function() {
                        window.open('https://www.youtube.com/watch?v=OgGYQGPYvu0&ab_channel=TeamCoco', '_blank');
                        DNAButton.showDNA();
                        Conversation.playThankYou();
                    }, 800);
                } else if (choiceIndex === 2) { // Merkel
                    setTimeout(function() {
                        window.open('https://www.youtube.com/watch?v=GVn_zcLJGNQ&t=63s&ab_channel=NationalTreasured', '_blank');
                        DNAButton.showDNA();
                        Conversation.playThankYou();
                    }, 800);
                }
            },

            handleCallChoice: function(choiceIndex) {
                this.playConfirmationSound();
                this.animateChoiceClick();
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    Conversation.playThankYou();
                }, 800);
            },

            handleMotherScaleChoice: function(rating) {
                this.playConfirmationSound();
                this.animateChoiceClick();
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    Conversation.playThankYou();
                }, 800);
            },

            handleAIChoice: function(aiType) {
                this.playConfirmationSound();
                this.animateChoiceClick();
                
                State.selectedAIType = aiType;
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    Conversation.playThankYou();
                }, 800);
            }
        };

        var AudioManager = {
            tryStartBackgroundMusic: function() {
                if (!SG1.musicEnabled) return;
                
                var music = UI.element('backgroundMusic');
                if (!music) return;
                
                music.volume = 0.3;
                music.muted = false;
                
                var playPromise = music.play();
                if (playPromise) {
                    playPromise.then(function() {
                        console.log('✅ Background music started successfully!');
                    }).catch(function(e) {
                        console.log('❌ Background music prevented: ' + e.name + ' - ' + e.message);
                    });
                }
            },
            
            stopAllSpeech: function() {
                if (State.synthesis) State.synthesis.cancel();
            }
        };

        var WebAudioHelper = {
            isMobile: /iPhone|iPad|iPod|Android/i.test(navigator.userAgent),
            buffers: {},
            currentSource: null,
            
            ensureContext: function() {
                if (!window.globalAudioContext && window.AudioContext) {
                    window.globalAudioContext = new AudioContext();
                }
                return window.globalAudioContext;
            },
            
            load: function(url) {
                var self = this;
                var ctx = self.ensureContext();
                if (!ctx) return Promise.reject();
                
                if (self.buffers[url]) {
                    return Promise.resolve(self.buffers[url]);
                }
                
                return fetch(url)
                    .then(r => r.arrayBuffer())
                    .then(data => new Promise((resolve, reject) => {
                        ctx.decodeAudioData(data, function(buffer) {
                            self.buffers[url] = buffer;
                            resolve(buffer);
                        }, function(e) {
                            reject(e);
                        });
                    }));
            },
            
            play: function(url, onended, onerror) {
                var self = this;
                self.load(url).then(function(buffer) {
                    var ctx = self.ensureContext();
                    if (ctx.state === 'suspended') {
                        ctx.resume().then(function() {
                            self._playBuffer(ctx, buffer, onended, onerror, url);
                        }).catch(function(e) {
                            if (onerror) onerror(e);
                        });
                    } else {
                        self._playBuffer(ctx, buffer, onended, onerror, url);
                    }
                }).catch(function(e){
                    if (onerror) onerror(e);
                });
            },
            
            _playBuffer: function(ctx, buffer, onended, onerror, url) {
                if (this.currentSource) {
                    try { 
                        this.currentSource.onended = null; 
                        this.currentSource.stop(); 
                    } catch(e){}
                    this.currentSource = null;
                }
                
                var source = ctx.createBufferSource();
                source.buffer = buffer;
                source.connect(ctx.destination);
                source.onended = function() {
                    if (onended) onended();
                };
                
                try {
                    source.start(0);
                } catch(e) {
                    if (onerror) onerror(e);
                }
                
                this.currentSource = source;
            }
        };

        var Conversation = {
            playThankYou: function() {
                State.isSpeaking = true;
                UI.setVisualizerState('speaking');
                
                if (WebAudioHelper.isMobile && State.audioUnlocked && window.AudioContext) {
                    WebAudioHelper.play(
                        State.thankYouAudio,
                        function() {
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                        },
                        function(e) {
                            State.isSpeaking = false;
                            setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                        }
                    );
                } else {
                    var audio = new Audio(State.thankYouAudio);
                    audio.onended = function() {
                        State.isSpeaking = false;
                        UI.setVisualizerState('active');
                        setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                    };
                    audio.onerror = function(e) {
                        State.isSpeaking = false;
                        setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                    };
                    audio.play().catch(function(e) {
                        State.isSpeaking = false;
                        setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                    });
                }
            },

            moveToNextQuestion: function() {
                State.step++;
                
                if (State.step === 13 && State.selectedAIType) {
                    if (State.selectedAIType === 'male') {
                        State.step = 13;
                    } else if (State.selectedAIType === 'female') {
                        State.step = 14;
                    } else if (State.selectedAIType === 'diverse') {
                        State.step = 15;
                    }
                }
                
                if (State.step === 14 && State.selectedAIType === 'male') {
                    State.step = 16;
                } else if (State.step === 15 && State.selectedAIType === 'female') {
                    State.step = 16;
                } else if (State.step === 16 && State.selectedAIType === 'diverse') {
                    State.step = 16;
                }
                
                if (State.step >= 18) {
                    this.completeCourse();
                    return;
                }
                
                UI.updateProgress((State.step + 1) * (100/18));
                
                State.isSpeaking = true;
                UI.setVisualizerState('speaking');
                
                var audioUrl = State.audioFiles[State.step];
                
                if (WebAudioHelper.isMobile && State.audioUnlocked && window.AudioContext) {
                    WebAudioHelper.play(
                        audioUrl,
                        function() {
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            Conversation.showNextButton();
                        },
                        function(e) {
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            Conversation.showNextButton();
                        }
                    );
                } else {
                    var audio = new Audio(audioUrl);
                    audio.onended = function() {
                        State.isSpeaking = false;
                        UI.setVisualizerState('active');
                        Conversation.showNextButton();
                    };
                    audio.onerror = function(e) {
                        State.isSpeaking = false;
                        UI.setVisualizerState('active');
                        Conversation.showNextButton();
                    };
                    audio.play().catch(function(e) {
                        State.isSpeaking = false;
                        UI.setVisualizerState('active');
                        Conversation.showNextButton();
                    });
                }
            },

            showNextButton: function() {
                setTimeout(function() {
                    switch(State.step) {
                        case 0:
                            DNAButton.showText('Bereit');
                            break;
                        case 1:
                            DNAButton.showAnswerChoices();
                            break;
                        case 2:
                            DNAButton.showGoalInput();
                            break;
                        case 3:
                            DNAButton.showTimeChoices();
                            break;
                        case 4:
                            DNAButton.showProbabilityChoices();
                            break;
                        case 5:
                            DNAButton.showScaleChoices();
                            break;
                        case 6:
                            DNAButton.showScaleChoices();
                            break;
                        case 7:
                            DNAButton.showFoodChoices();
                            break;
                        case 8:
                            DNAButton.showGermanChoices();
                            break;
                        case 9:
                            DNAButton.showMotherInput();
                            break;
                        case 10:
                            DNAButton.showCallChoices();
                            break;
                        case 11:
                            DNAButton.showMotherScaleChoices();
                            break;
                        case 12:
                            DNAButton.showAIChoices();
                            break;
                        case 13:
                        case 14:
                        case 15:
                            setTimeout(function() {
                                Conversation.moveToNextQuestion();
                            }, 2000);
                            break;
                        case 16:
                            setTimeout(function() {
                                Conversation.moveToNextQuestion();
                            }, 2000);
                            break;
                        case 17:
                            setTimeout(function() {
                                Conversation.completeCourse();
                            }, 2000);
                            break;
                        default:
                            break;
                    }
                }, 1000);
            },

            completeCourse: function() {
                setTimeout(function() {
                    var buttons = document.querySelectorAll('button, .btn, [role="button"]');
                    for (var i = 0; i < buttons.length; i++) {
                        var btn = buttons[i];
                        var text = btn.textContent.toLowerCase();
                        if (text.indexOf('complete') !== -1 || text.indexOf('continue') !== -1 || text.indexOf('next') !== -1) {
                            btn.click();
                            return;
                        }
                    }
                }, 2000);
            },

            startQ1: function() {
                var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                if (isMobile && State.mobileAudioStarted) return;
                
                UI.setVisualizerState('active');
                UI.updateProgress(5);
                State.step = 0;
                
                var url = State.audioFiles[0];
                UI.setVisualizerState('speaking');
                
                if (window.AudioContext && WebAudioHelper) {
                    WebAudioHelper.play(url, function() {
                        UI.setVisualizerState('active');
                        setTimeout(function() { 
                            DNAButton.showText('Bereit'); 
                        }, 2000);
                    }, function(e) {
                        UI.setVisualizerState('active');
                        setTimeout(function() { 
                            DNAButton.showText('Bereit'); 
                        }, 2000);
                    });
                } else {
                    var audio = new Audio(url);
                    audio.onended = function() {
                        UI.setVisualizerState('active');
                        setTimeout(function() { DNAButton.showText('Bereit'); }, 2000);
                    };
                    audio.onerror = function(e) {
                        UI.setVisualizerState('active');
                        setTimeout(function() { DNAButton.showText('Bereit'); }, 2000);
                    };
                    audio.play();
                }
            }
        };

        var SG1 = {
            musicEnabled: true,
            
            toggleMusic: function() {
                var music = UI.element('backgroundMusic');
                var indicator = UI.element('musicIndicator');
                
                if (this.musicEnabled) {
                    if (music) music.pause();
                    if (indicator) indicator.classList.add('off');
                    this.musicEnabled = false;
                } else {
                    if (music) {
                        var playPromise = music.play();
                        if (playPromise) {
                            playPromise.then(function() {
                                console.log('Music resumed successfully');
                            }).catch(function(e) {
                                console.log('Music resume failed: ' + e.message);
                            });
                        }
                    }
                    if (indicator) indicator.classList.remove('off');
                    this.musicEnabled = true;
                }
            },
            
            beginInitialization: function() {
                var preInitButton = document.querySelector('.pre-init-button');
                if (preInitButton) {
                    preInitButton.style.transform = 'scale(0.95)';
                    preInitButton.style.opacity = '0.7';
                    preInitButton.textContent = 'Starting...';
                }
                
                var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                
                var unlockAudio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiI2OvKcyMFl2+z9N2aPAIbWr9yxmAXGFnj8MJzJQUYYbf2xGIYG1nq6MJzJQUYlGt19Mhvaz5gXFztw2kdA0qP2uzGeTYFG3a36Pn0YlFmdXTs8bHnzLqLh6uYfJBaRoZ1puLsxXEvCSdtytNdKAkzWLz6qHNxMEOw6MtbKhJLkM/d3QBVL9JKR5X2QQAwfOYTM8cVkPB29ppqOZN17+o1GAbSrAXvOK9qVsO2P2bfyXU5aOPYqE+TKYeKc1PEJd+7L2XKHOd6d1qTKZ2pXPHZq36DWdF4VJOhJr6l9YNkFJdFaLyJRjF7X1lGf61O2FO8gY0n');
                unlockAudio.volume = 0.01;
                
                unlockAudio.play().then(function() {
                    State.audioUnlocked = true;
                    
                    try {
                        if (!window.globalAudioContext && window.AudioContext) {
                            window.globalAudioContext = new AudioContext();
                        }
                        if (window.globalAudioContext && window.globalAudioContext.state === 'suspended') {
                            window.globalAudioContext.resume();
                        }
                    } catch (e) {}
                }).catch(function(e) {
                    State.audioUnlocked = false;
                });
                
                var music = UI.element('backgroundMusic');
                if (music && SG1.musicEnabled) {
                    music.volume = 0.3;
                    music.play().catch(function(e) {
                        console.log('❌ Background music failed: ' + e.message);
                    });
                }
                
                if (isMobile) {
                    try {
                        var ctx = window.globalAudioContext || (window.AudioContext ? new AudioContext() : null);
                        if (ctx) {
                            var buffer = ctx.createBuffer(1, 1, 22050);
                            var source = ctx.createBufferSource();
                            source.buffer = buffer;
                            source.connect(ctx.destination);
                            source.start(0);
                        }
                    } catch (e) {}
                }
                
                setTimeout(function() {
                    try {
                        if (document.documentElement.requestFullscreen) {
                            document.documentElement.requestFullscreen().catch(function(e) {});
                        } else if (document.documentElement.webkitRequestFullscreen) {
                            document.documentElement.webkitRequestFullscreen();
                        } else if (document.documentElement.mozRequestFullScreen) {
                            document.documentElement.mozRequestFullScreen();
                        }
                    } catch (e) {}
                    
                    UI.hideElement('preInitOverlay');
                    UI.showElement('initOverlay');
                    
                    SG1.startInitialization();
                }, 300);
            },

            startInitialization: function() {
                var logo = document.querySelector('.init-logo');
                var status = UI.element('statusText');
                
                if (status) status.textContent = 'Audio system ready. Loading voice...';
                
                if (logo) {
                    logo.style.opacity = '0';
                    logo.style.animation = 'none';
                    logo.style.transform = 'translate(-50%, -50%) scale(0.8)';
                    
                    setTimeout(function() {
                        if (status) {
                            status.textContent = 'Voice system online. Starting sequence...';
                            setTimeout(function() {
                                status.style.transition = 'opacity 1s ease-out';
                                status.style.opacity = '0';
                            }, 2000);
                        }
                        
                        logo.style.animation = 'sg1LogoFade 16s ease-in-out forwards';
                        
                        setTimeout(function() {
                            if (logo.style.opacity === '0') {
                                logo.style.opacity = '1';
                                logo.style.transform = 'translate(-50%, -50%) scale(1)';
                                
                                setTimeout(function() {
                                    logo.style.opacity = '0';
                                }, 10000);
                            }
                        }, 3000);
                        
                        setTimeout(function() {
                            logo.style.opacity = '0';
                            logo.style.display = 'none';
                        }, 15000);
                        
                    }, 1000);
                }
                
                setTimeout(function() {
                    if (status) status.textContent = 'Loading neural interface...';
                    UI.showElement('visualizer');
                    
                    var visualizer = UI.element('visualizer');
                    if (visualizer) {
                        visualizer.style.opacity = '0';
                        visualizer.style.transition = 'opacity 4s ease-in';
                        setTimeout(function() {
                            visualizer.style.opacity = '1';
                        }, 100);
                    }
                    
                    var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                    if (isMobile && !State.mobileAudioStarted) {
                        setTimeout(function() {
                            var mobileVoiceAudio = new Audio(State.audioFiles[0]);
                            mobileVoiceAudio.volume = 1.0;
                            
                            var playPromise = mobileVoiceAudio.play();
                            if (playPromise) {
                                playPromise.then(function() {
                                    State.isSpeaking = true;
                                    State.step = 0;
                                    State.mobileAudioStarted = true;
                                    UI.setVisualizerState('speaking');
                                    
                                    mobileVoiceAudio.onended = function() {
                                        State.isSpeaking = false;
                                        UI.setVisualizerState('active');
                                        setTimeout(function() { 
                                            DNAButton.showText('Bereit'); 
                                        }, 1000);
                                    };
                                }).catch(function(e) {});
                            }
                        }, 4100);
                    }
                }, 15000);

                setTimeout(function() {
                    if (status) status.textContent = 'Ready to begin...';
                    UI.hideElement('initOverlay');
                    setTimeout(function() {
                        Conversation.startQ1();
                    }, 500);
                }, 18000);
            },

            init: function() {
                console.log('SG1 initialized');
            }
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                SG1.init();
            });
        } else {
            SG1.init();
        }

        window.onerror = function(message, source, lineno, colno, error) {
            console.log('ERROR: ' + message + ' at line ' + lineno);
            return false;
        };
</script>
</body>
</html>