<!DOCTYPE html>
<html lang="en">
<head>
  <title>SG1 - AI-Setup</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SG1 - AI German Learning System</title>
    <style>
        /* ===== BASE STYLES ===== */
        body, html { margin: 0; padding: 0; height: 100%; background: none; }
        .sg1-container * { margin: 0; padding: 0; box-sizing: border-box; }

        .sg1-container { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999999;
            background: linear-gradient(-45deg, #4ecdc4, #45b7d1, #96ceb4, #ffecd2);
            background-size: 400% 400%; animation: sg1GradientShift 15s ease infinite;
            overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        @keyframes sg1GradientShift { 
            0% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
            100% { background-position: 0% 50%; } 
        }

        /* ===== OVERLAYS ===== */
        .overlay-base { position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; transition: opacity 1s ease-out; }

        .pre-init-overlay { 
            z-index: 2000; opacity: 1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }

        .init-overlay { 
            z-index: 1000; opacity: 0; pointer-events: none;
            background: none !important;
            transition: opacity 0.5s ease;
        }
        .init-overlay.visible { 
            opacity: 1; pointer-events: all;
            background: none !important;
        }
        .init-overlay.hidden { 
            opacity: 0; pointer-events: none; display: none !important;
            background: none !important;
        }

        /* ===== MUSIC INDICATOR ===== */
        .music-indicator { 
            position: fixed; top: 20px; right: 20px; 
            color: rgba(255, 255, 255, 0.7); 
            font-size: 14px; 
            cursor: pointer; 
            user-select: none; 
            z-index: 10000;
            transition: color 0.3s ease;
        }
        .music-indicator:hover { 
            color: rgba(255, 255, 255, 1); 
        }
        .music-indicator.off { 
            text-decoration: line-through; 
        }

        /* ===== PRE-INIT BUTTON ===== */
        .pre-init-button { background: #4ecdc4; color: white; border: none; padding: 20px 40px;
            border-radius: 15px; font-size: 1.2em; font-weight: 500; letter-spacing: 1px; cursor: pointer;
            transition: all 0.4s ease; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); display: inline-block; }
        .pre-init-button:hover { background: #45b7d1; transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); }

        /* ===== LOGO ANIMATION ===== */
        .init-logo { 
            font-size: clamp(5em, 20vw, 7.5em); font-weight: 100; color: white; letter-spacing: 3px;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            opacity: 0;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        @keyframes sg1LogoFade {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            35% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            85% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
        }

        /* ===== DNA VISUALIZER WITH TEXT BUTTON CAPABILITY ===== */
        .voice-visualizer { 
            height: 120px; width: min(450px, 85vw); position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: flex; align-items: center; justify-content: center; opacity: 0;
            cursor: pointer;
            transition: all 0.6s ease;
        }

        .dna-container { 
            display: flex; align-items: center; justify-content: center;
            z-index: 1; position: relative; width: min(400px, 80vw); height: 80px;
            transform-style: preserve-3d; perspective: 1000px;
        }

        /* DNA Strands */
        .dna-strand { 
            fill: none; stroke: white; stroke-width: 5; stroke-linecap: round;
            animation: sg1DNAFlow 5s linear infinite;
            transform-origin: 50% 50%;
            filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.3));
            opacity: 1;
            transition: opacity 0.8s ease;
        }
        .dna-strand:nth-child(2) { 
            animation-delay: 0.5s;
            filter: drop-shadow(1px 1px 3px rgba(0, 0, 0, 0.35));
        }
        .dna-strand:nth-child(3) { 
            animation-delay: 1s;
            filter: drop-shadow(1px 1px 4px rgba(0, 0, 0, 0.4));
        }

        @keyframes sg1DNAFlow {
            0% { transform: rotateX(0deg); }
            100% { transform: rotateX(360deg); }
        }

        /* Fast speaking animations */
        @keyframes sg1DNAFlowFast1 {
            0% { transform: rotateX(0deg); }
            20% { transform: rotateX(120deg); }
            40% { transform: rotateX(180deg); }
            70% { transform: rotateX(300deg); }
            100% { transform: rotateX(360deg); }
        }
        @keyframes sg1DNAFlowFast2 {
            0% { transform: rotateX(0deg); }
            30% { transform: rotateX(90deg); }
            50% { transform: rotateX(240deg); }
            80% { transform: rotateX(300deg); }
            100% { transform: rotateX(360deg); }
        }
        @keyframes sg1DNAFlowFast3 {
            0% { transform: rotateX(0deg); }
            15% { transform: rotateX(150deg); }
            60% { transform: rotateX(210deg); }
            85% { transform: rotateX(330deg); }
            100% { transform: rotateX(360deg); }
        }

        .speaking .dna-strand { 
            stroke-width: 6; 
        }
        .speaking .dna-strand:nth-child(1) { 
            animation: sg1DNAFlowFast1 0.7s ease-in-out infinite; 
        }
        .speaking .dna-strand:nth-child(2) { 
            animation: sg1DNAFlowFast2 0.5s ease-in-out infinite; 
        }
        .speaking .dna-strand:nth-child(3) { 
            animation: sg1DNAFlowFast3 0.6s ease-in-out infinite; 
        }

        .listening .dna-strand { 
            animation: sg1DNAFlow 2s linear infinite;
            stroke: #ffd54f;
            filter: drop-shadow(1px 1px 3px rgba(255, 213, 79, 0.4));
        }

        /* ===== DNA TEXT BUTTON ===== */
        .dna-text-button {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.95);
            font-size: clamp(20px, 5vw, 28px);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-weight: 200;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            opacity: 0;
            pointer-events: none;
            transition: all 0.8s ease;
            cursor: pointer;
            z-index: 10;
            white-space: nowrap;
        }

        .dna-text-button.visible {
            opacity: 1;
            pointer-events: all;
        }

        .dna-text-button:hover {
            color: rgba(255, 255, 255, 1);
            transform: translate(-50%, -50%) translateY(-3px);
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
        }

        /* DNA state when showing text */
        .voice-visualizer.text-mode .dna-strand {
            opacity: 0;
        }

        .voice-visualizer.text-mode .dna-text-button {
            opacity: 1;
            pointer-events: all;
        }

        /* Answer choices container */
        .answer-choices-container {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.8s ease;
            z-index: 10;
        }

        .answer-choices-container.visible {
            opacity: 1;
            pointer-events: all;
        }

        .answer-choice {
            color: rgba(255, 255, 255, 0.95);
            font-size: clamp(14px, 3.5vw, 16px);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-weight: 200;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            text-align: center;
            min-width: 250px;
            position: relative;
        }

        .answer-choice:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            color: rgba(255, 255, 255, 1);
        }

        .answer-translation {
            font-size: 12px;
            opacity: 0.7;
            font-style: italic;
            margin-top: 5px;
        }

        /* Time and probability buttons */
        .time-probability-container {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 20px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.8s ease;
            z-index: 10;
            flex-wrap: wrap;
            justify-content: center;
        }

        .time-probability-container.visible {
            opacity: 1;
            pointer-events: all;
        }

        .time-choice, .probability-choice {
            color: rgba(255, 255, 255, 0.95);
            font-size: clamp(16px, 4vw, 20px);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-weight: 200;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            cursor: pointer;
            padding: 15px 25px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
        }

        .time-choice:hover, .probability-choice:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            color: rgba(255, 255, 255, 1);
        }

        /* ===== PROGRESS BAR ===== */
        .progress-container { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: min(400px, 80vw); height: 4px; background: rgba(255, 255, 255, 0.2);
            border-radius: 2px; overflow: hidden; z-index: 50;
        }
        .progress-bar { 
            height: 100%; background: linear-gradient(90deg, #4ecdc4, #45b7d1);
            width: 0%; transition: width 1s ease; border-radius: 2px;
        }

        /* ===== UTILITY ===== */
        .hidden { opacity: 0 !important; pointer-events: none !important; }
        .visible { opacity: 1 !important; pointer-events: all !important; }
        .active { display: flex !important; }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .answer-choice {
                min-width: 280px;
                font-size: 14px;
            }

            .time-probability-container {
                flex-direction: column;
                gap: 15px;
            }

            .time-choice, .probability-choice {
                min-width: 120px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="sg1-container">
        <!-- Music indicator on all screens -->
        <div class="music-indicator" id="musicIndicator" onclick="SG1.toggleMusic()">music</div>

        <div class="pre-init-overlay overlay-base" id="preInitOverlay">
            <button class="pre-init-button" onclick="SG1.beginInitialization()">Initiate AI</button>
        </div>

        <div class="init-overlay overlay-base" id="initOverlay">
            <div class="init-logo">SG1</div>
            <div style="position: absolute; bottom: 100px; color: white; font-size: 16px; opacity: 0.8;" id="statusText">Initializing audio system...</div>
        </div>

        <div class="voice-visualizer" id="visualizer" onclick="DNAButton.handleClick()">
            <div class="dna-container">
                <svg width="100%" height="80" viewBox="0 0 400 80">
                    <path class="dna-strand" d="M0,40 Q50,15 100,40 Q150,65 200,40 Q250,15 300,40 Q350,65 400,40" />
                    <path class="dna-strand" d="M0,40 Q50,65 100,40 Q150,15 200,40 Q250,65 300,40 Q350,15 400,40" />
                    <path class="dna-strand" d="M0,40 Q50,15 100,40 Q150,65 200,40 Q250,15 300,40 Q350,65 400,40" />
                </svg>
                
                <!-- Text button overlay -->
                <div class="dna-text-button" id="dnaTextButton"></div>
                
                <!-- Answer choices for question 1 -->
                <div class="answer-choices-container" id="answerChoicesContainer">
                    <div class="answer-choice" onclick="DNAButton.handleAnswerChoice(0)">
                        Gute Frage
                        <div class="answer-translation">Good question</div>
                    </div>
                    <div class="answer-choice" onclick="DNAButton.handleAnswerChoice(1)">
                        Das geht Dich gar nichts an
                        <div class="answer-translation">That's none of your business</div>
                    </div>
                    <div class="answer-choice" onclick="DNAButton.handleAnswerChoice(2)">
                        Keine Ahnung
                        <div class="answer-translation">No idea</div>
                    </div>
                </div>

                <!-- Time commitment choices for question 3 -->
                <div class="time-probability-container" id="timeChoicesContainer">
                    <div class="time-choice" onclick="DNAButton.handleTimeChoice(0)">1h/w</div>
                    <div class="time-choice" onclick="DNAButton.handleTimeChoice(1)">5hrs/w</div>
                    <div class="time-choice" onclick="DNAButton.handleTimeChoice(2)">15hrs/w</div>
                </div>

                <!-- Probability choices for question 4 -->
                <div class="time-probability-container" id="probabilityChoicesContainer">
                    <div class="probability-choice" onclick="DNAButton.handleProbabilityChoice('low')">&lt;50%</div>
                    <div class="probability-choice" onclick="DNAButton.handleProbabilityChoice('medium')">80%</div>
                    <div class="probability-choice" onclick="DNAButton.handleProbabilityChoice('high')">100%</div>
                </div>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- Background music -->
        <audio id="backgroundMusic" loop preload="auto">
            <source src="https://uploads.teachablecdn.com/attachments/1b02582168af4a60adcfc9dc91660d37.mp3" type="audio/mpeg">
        </audio>
    </div>

<script>
        // Simple console-only debug replacement
        var DebugLog = {
            log: function(message) {
                var timestamp = new Date().toLocaleTimeString();
                var logMessage = '[' + timestamp + '] ' + String(message);
                // try { console.log(logMessage); } catch(e){}
            },
            init: function() {
                // console.log('=== DEBUG SYSTEM INITIALIZED (CONSOLE ONLY) ===');
            }
        };

        var State = {
            step: 0,
            isSpeaking: false,
            motherInterruptTimer: null,
            inFinalSequence: false,
            audioUnlocked: false,
            mobileAudioStarted: false,
            holdingTimer: null,
            
            audioFiles: {
                0: 'https://uploads.teachablecdn.com/attachments/fa6567b6d8e64c3dbb04265db8f4b44f.mp3',
                1: 'https://uploads.teachablecdn.com/attachments/91dd16c7d1c64ce6afb59a1d72ded03b.mp3',
                2: 'https://uploads.teachablecdn.com/attachments/e37c338dcbe745859c45484d45f14666.mp3',
                3: 'https://uploads.teachablecdn.com/attachments/54355724a83d440cb199271eafe57e24.mp3',
                4: 'https://uploads.teachablecdn.com/attachments/95631cf6057642709b18f5902c511958.mp3',
                5: 'https://uploads.teachablecdn.com/attachments/e85d721b671746169040af93a4aa37b1.mp3',
                6: 'https://uploads.teachablecdn.com/attachments/ac76bcc7a7dd4544b0364e277ceb0970.mp3',
                7: 'https://uploads.teachablecdn.com/attachments/0cdfc0ce7a3245618d7fed8ce25d7d3b.mp3',
                8: 'https://uploads.teachablecdn.com/attachments/28a3453828b247529b17c6cfc0cc745c.mp3'
            },
            
            thankYouAudio: 'https://uploads.teachablecdn.com/attachments/4e2906fba5dc40e6bd0d294332e94123.mp3',
            finalThankYouAudio: 'https://uploads.teachablecdn.com/attachments/8f1a13b6a0e14abb885ef5f979d3d6c7.mp3',
            
            questions: [
                "Welcome to the world's first artificially intelligent German Course system, SG1.",
                "Why do you want to learn German? I mean seriously: WHY?",
                "What's your goal? Where do you want to be with your German after what amount of time?",
                "How much time do you plan to spend on your German?",
                "How probable is it that you will reach your goal?",
                "How would you describe your relationship with your mother?",
                "Hi there. My name is Michael. I'll be your instructor for the coming 23.5 years. But don't despair. Even the longest journey will come to an end eventually. Sooner or later. In your case rather later. Shall we begin?"
            ]
        };

        var UI = {
            element: function(id) { 
                return document.getElementById(id); 
            },
            
            showElement: function(id) { 
                var element = this.element(id);
                if (element) {
                    element.classList.remove('hidden');
                    element.classList.add('active', 'visible');
                    element.style.display = 'flex';
                    if (id === 'visualizer') {
                        element.style.opacity = '1';
                    }
                }
            },
            
            hideElement: function(id) { 
                var element = this.element(id);
                if (element) {
                    element.classList.remove('active', 'visible');
                    element.classList.add('hidden');
                }
            },
            
            setVisualizerState: function(state) { 
                var visualizer = this.element('visualizer');
                if (visualizer) {
                    visualizer.className = 'voice-visualizer active ' + state;
                    DebugLog.log('DNA visualizer state: ' + state);
                }
            },
            
            updateProgress: function(percentage) {
                var bar = this.element('progressBar');
                if (bar) bar.style.width = percentage + '%';
            }
        };

        // DNA Button Controller - handles the DNA-to-text transformation
        var DNAButton = {
            currentMode: 'dna', // 'dna', 'text', 'choices', 'time', 'probability'
            
            // Show text on DNA
            showText: function(text) {
                var visualizer = UI.element('visualizer');
                var textButton = UI.element('dnaTextButton');
                
                if (textButton && visualizer) {
                    textButton.textContent = text;
                    visualizer.classList.add('text-mode');
                    textButton.classList.add('visible');
                    this.currentMode = 'text';
                    DebugLog.log('DNA showing text: ' + text);
                }
            },
            
            // Hide text and show DNA
            hideTex: function() {
                var visualizer = UI.element('visualizer');
                var textButton = UI.element('dnaTextButton');
                
                if (textButton && visualizer) {
                    visualizer.classList.remove('text-mode');
                    textButton.classList.remove('visible');
                    this.currentMode = 'dna';
                    DebugLog.log('DNA text hidden, showing DNA');
                }
            },

            // Show answer choices
            showAnswerChoices: function() {
                var visualizer = UI.element('visualizer');
                var choicesContainer = UI.element('answerChoicesContainer');
                
                if (choicesContainer && visualizer) {
                    visualizer.classList.add('text-mode'); // Hide DNA
                    choicesContainer.classList.add('visible');
                    this.currentMode = 'choices';
                    DebugLog.log('DNA showing answer choices');
                }
            },

            // Show time choices
            showTimeChoices: function() {
                var visualizer = UI.element('visualizer');
                var timeContainer = UI.element('timeChoicesContainer');
                
                if (timeContainer && visualizer) {
                    visualizer.classList.add('text-mode'); // Hide DNA
                    timeContainer.classList.add('visible');
                    this.currentMode = 'time';
                    DebugLog.log('DNA showing time choices');
                }
            },

            // Show probability choices  
            showProbabilityChoices: function() {
                var visualizer = UI.element('visualizer');
                var probContainer = UI.element('probabilityChoicesContainer');
                
                if (probContainer && visualizer) {
                    visualizer.classList.add('text-mode'); // Hide DNA
                    probContainer.classList.add('visible');
                    this.currentMode = 'probability';
                    DebugLog.log('DNA showing probability choices');
                }
            },
            
            // Hide all overlays and show DNA
            showDNA: function() {
                var visualizer = UI.element('visualizer');
                var textButton = UI.element('dnaTextButton');
                var choicesContainer = UI.element('answerChoicesContainer');
                var timeContainer = UI.element('timeChoicesContainer');
                var probContainer = UI.element('probabilityChoicesContainer');
                
                if (visualizer) {
                    visualizer.classList.remove('text-mode');
                    if (textButton) textButton.classList.remove('visible');
                    if (choicesContainer) choicesContainer.classList.remove('visible');
                    if (timeContainer) timeContainer.classList.remove('visible');
                    if (probContainer) probContainer.classList.remove('visible');
                    this.currentMode = 'dna';
                    DebugLog.log('DNA visible, all text hidden');
                }
            },
            
            // Handle clicks on the DNA area
            handleClick: function() {
                if (this.currentMode !== 'text') return;
                
                DebugLog.log('DNA text button clicked for step ' + State.step);
                
                // Add click animation
                this.animateClick();
                
                // Handle based on current step
                switch(State.step) {
                    case 0: // Bereit
                        this.handleBereit();
                        break;
                    case 2: // Hold to speak
                    case 5: // Mother question hold to speak
                    case 7: // Final hold to speak
                        this.handleHoldToSpeak();
                        break;
                    case 6: // Ja
                        this.handleJa();
                        break;
                    case 8: // Na gut
                        this.handleNaGut();
                        break;
                }
            },

            // Handle answer choices
            handleAnswerChoice: function(choiceIndex) {
                if (this.currentMode !== 'choices') return;
                
                DebugLog.log('Answer choice clicked: ' + choiceIndex);
                this.animateChoiceClick();
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    Conversation.moveToNextQuestion();
                }, 800);
            },

            // Handle time choices
            handleTimeChoice: function(choiceIndex) {
                if (this.currentMode !== 'time') return;
                
                DebugLog.log('Time choice clicked: ' + choiceIndex);
                this.animateChoiceClick();
                
                setTimeout(function() {
                    DNAButton.showDNA();
                    Conversation.moveToNextQuestion();
                }, 800);
            },

            // Handle probability choices
            handleProbabilityChoice: function(level) {
                if (this.currentMode !== 'probability') return;
                
                DebugLog.log('Probability choice clicked: ' + level);
                this.animateChoiceClick();
                
                // Special handling for <50% option
                if (level === 'low') {
                    setTimeout(function() {
                        window.open('https://smartergerman.com/courses/unblock-your-german/', '_blank');
                        DNAButton.showDNA();
                        Conversation.moveToNextQuestion();
                    }, 800);
                } else {
                    setTimeout(function() {
                        DNAButton.showDNA();
                        Conversation.moveToNextQuestion();
                    }, 800);
                }
            },
            
            // Animate text click
            animateClick: function() {
                var textButton = UI.element('dnaTextButton');
                if (textButton) {
                    textButton.style.transform = 'translate(-50%, -50%) scale(0.95)';
                    textButton.style.opacity = '0.7';
                    
                    setTimeout(function() {
                        textButton.style.transform = 'translate(-50%, -50%) scale(1)';
                        textButton.style.opacity = '1';
                    }, 200);
                }
            },

            // Animate choice click
            animateChoiceClick: function() {
                var containers = ['answerChoicesContainer', 'timeChoicesContainer', 'probabilityChoicesContainer'];
                containers.forEach(function(id) {
                    var container = UI.element(id);
                    if (container && container.classList.contains('visible')) {
                        container.style.opacity = '0';
                        container.style.transform = 'translate(-50%, -50%) translateY(10px)';
                    }
                });
            },
            
            // Button handlers
            handleBereit: function() {
                this.showDNA();
                setTimeout(function() {
                    Conversation.moveToNextQuestion();
                }, 1000);
            },
            
            handleHoldToSpeak: function() {
                if (State.isSpeaking) return;
                
                DebugLog.log('Hold to speak activated');
                
                // Change text to indicate recording
                var textButton = UI.element('dnaTextButton');
                if (textButton) {
                    textButton.textContent = 'Recording...';
                    textButton.style.color = 'rgba(255, 213, 79, 0.95)';
                }
                
                UI.setVisualizerState('listening');
                
                // Auto-release after 3 seconds or if it's the mother question with timer
                var holdDuration = (State.step === 5) ? 7000 : 3000;
                
                State.holdingTimer = setTimeout(function() {
                    DNAButton.stopHoldToSpeak();
                }, holdDuration);
            },
            
            stopHoldToSpeak: function() {
                DebugLog.log('Hold to speak released');
                
                if (State.holdingTimer) {
                    clearTimeout(State.holdingTimer);
                    State.holdingTimer = null;
                }
                
                // Reset text color
                var textButton = UI.element('dnaTextButton');
                if (textButton) {
                    textButton.style.color = 'rgba(255, 255, 255, 0.95)';
                }
                
                this.showDNA();
                UI.setVisualizerState('active');
                
                setTimeout(function() {
                    if (State.step === 5) {
                        Conversation.moveToNextQuestion();
                    } else {
                        Conversation.playThankYou();
                    }
                }, 500);
            },
            
            handleJa: function() {
                this.showDNA();
                setTimeout(function() {
                    Conversation.moveToNextQuestion();
                }, 1000);
            },
            
            handleNaGut: function() {
                this.showDNA();
                Conversation.completeCourse();
            }
        };

        var AudioManager = {
            tryStartBackgroundMusic: function() {
                if (!SG1.musicEnabled) {
                    DebugLog.log('Music disabled, skipping start');
                    return;
                }
                
                var music = UI.element('backgroundMusic');
                if (!music) {
                    DebugLog.log('ERROR: Background music element not found');
                    return;
                }
                
                DebugLog.log('Attempting to start background music...');
                
                music.volume = 0.3;
                music.muted = false;
                
                var playPromise = music.play();
                if (playPromise) {
                    playPromise.then(function() {
                        DebugLog.log('âœ… Background music started successfully!');
                    }).catch(function(e) {
                        DebugLog.log('âŒ Background music prevented: ' + e.name + ' - ' + e.message);
                    });
                }
            },
            
            stopAllSpeech: function() {
                if (State.synthesis) State.synthesis.cancel();
            }
        };

        // --- Web Audio API helper for mobile ---
        var WebAudioHelper = {
            isMobile: /iPhone|iPad|iPod|Android/i.test(navigator.userAgent),
            buffers: {},
            currentSource: null,
            ensureContext: function() {
                if (!window.globalAudioContext && window.AudioContext) {
                    DebugLog.log('[WebAudioHelper] Creating global AudioContext');
                    window.globalAudioContext = new AudioContext();
                }
                if (window.globalAudioContext) DebugLog.log('[WebAudioHelper] globalAudioContext state: ' + window.globalAudioContext.state);
                return window.globalAudioContext;
            },
            load: function(url) {
                var self = this;
                DebugLog.log('[WebAudioHelper] load() called for: ' + url);
                var ctx = self.ensureContext();
                if (!ctx) {
                    DebugLog.log('[WebAudioHelper] No AudioContext available');
                    return Promise.reject();
                }
                if (self.buffers[url]) {
                    DebugLog.log('[WebAudioHelper] Buffer cache hit for: ' + url);
                    return Promise.resolve(self.buffers[url]);
                }
                DebugLog.log('[WebAudioHelper] Fetching and decoding: ' + url);
                return fetch(url)
                    .then(r => r.arrayBuffer())
                    .then(data => new Promise((resolve, reject) => {
                        ctx.decodeAudioData(data, function(buffer) {
                            DebugLog.log('[WebAudioHelper] Decoded buffer for: ' + url);
                            self.buffers[url] = buffer;
                            resolve(buffer);
                        }, function(e) {
                            DebugLog.log('[WebAudioHelper] decodeAudioData error: ' + (e && e.message));
                            reject(e);
                        });
                    }));
            },
            play: function(url, onended, onerror) {
                var self = this;
                DebugLog.log('[WebAudioHelper] play() called for: ' + url);
                self.load(url).then(function(buffer) {
                    var ctx = self.ensureContext();
                    DebugLog.log('[WebAudioHelper] Buffer ready for: ' + url);
                    DebugLog.log('[WebAudioHelper] globalAudioContext state before play: ' + ctx.state);
                    if (ctx.state === 'suspended') {
                        DebugLog.log('[WebAudioHelper] Resuming globalAudioContext...');
                        ctx.resume().then(function() {
                            DebugLog.log('[WebAudioHelper] globalAudioContext resumed. State: ' + ctx.state);
                            self._playBuffer(ctx, buffer, onended, onerror, url);
                        }).catch(function(e) {
                            DebugLog.log('[WebAudioHelper] globalAudioContext resume() failed: ' + (e && e.message));
                        });
                    } else {
                        self._playBuffer(ctx, buffer, onended, onerror, url);
                    }
                }).catch(function(e){
                    DebugLog.log('[WebAudioHelper] play() error: ' + (e && e.message));
                    if (onerror) onerror(e);
                });
            },
            _playBuffer: function(ctx, buffer, onended, onerror, url) {
                DebugLog.log('[WebAudioHelper] _playBuffer() for: ' + url);
                if (this.currentSource) {
                    DebugLog.log('[WebAudioHelper] Stopping previous source');
                    try { this.currentSource.onended = null; this.currentSource.stop(); } catch(e){ DebugLog.log('[WebAudioHelper] Error stopping previous source: ' + (e && e.message)); }
                    this.currentSource = null;
                }
                var source = ctx.createBufferSource();
                source.buffer = buffer;
                source.connect(ctx.destination);
                source.onended = function() {
                    DebugLog.log('[WebAudioHelper] onended fired for: ' + url);
                    if (onended) onended();
                };
                try {
                    DebugLog.log('[WebAudioHelper] Starting source for: ' + url);
                    source.start(0);
                } catch(e) {
                    DebugLog.log('[WebAudioHelper] Error starting source: ' + (e && e.message));
                    if (onerror) onerror(e);
                }
                this.currentSource = source;
            }
        };

        var Conversation = {
            playThankYou: function() {
                DebugLog.log('Playing thank you audio');
                State.isSpeaking = true;
                UI.setVisualizerState('speaking');
                if (WebAudioHelper.isMobile && State.audioUnlocked && window.AudioContext) {
                    WebAudioHelper.play(
                        State.thankYouAudio,
                        function() {
                            DebugLog.log('Thank you audio ended');
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                        },
                        function(e) {
                            DebugLog.log('Thank you audio error: ' + (e && e.message));
                            State.isSpeaking = false;
                            setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                        }
                    );
                } else {
                    var audio = new Audio(State.thankYouAudio);
                    audio.onended = function() {
                        DebugLog.log('Thank you audio ended');
                        State.isSpeaking = false;
                        UI.setVisualizerState('active');
                        setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                    };
                    audio.onerror = function(e) {
                        DebugLog.log('Thank you audio error: ' + e.message);
                        State.isSpeaking = false;
                        setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                    };
                    audio.play().catch(function(e) {
                        DebugLog.log('Thank you audio play failed: ' + e.message);
                        State.isSpeaking = false;
                        setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                    });
                }
            },

            moveToNextQuestion: function() {
                if (State.inFinalSequence && State.step >= 8) {
                    return;
                }
                
                State.step++;
                DebugLog.log('Moving to step ' + State.step);
                
                if (State.step >= State.questions.length) {
                    this.completeCourse();
                } else {
                    UI.updateProgress((State.step + 1) * 9);
                    
                    // Play the audio for the current step
                    State.isSpeaking = true;
                    UI.setVisualizerState('speaking');
                    
                    var audioUrl = State.audioFiles[State.step];
                    DebugLog.log('Playing audio for step ' + State.step + ': ' + audioUrl);
                    
                    if (WebAudioHelper.isMobile && State.audioUnlocked && window.AudioContext) {
                        WebAudioHelper.play(
                            audioUrl,
                            function() {
                                DebugLog.log('Audio ended for step ' + State.step);
                                State.isSpeaking = false;
                                UI.setVisualizerState('active');
                                Conversation.showNextButton();
                            },
                            function(e) {
                                DebugLog.log('Audio error for step ' + State.step + ': ' + (e && e.message));
                                State.isSpeaking = false;
                                UI.setVisualizerState('active');
                                Conversation.showNextButton();
                            }
                        );
                    } else {
                        var audio = new Audio(audioUrl);
                        audio.onended = function() {
                            DebugLog.log('Audio ended for step ' + State.step);
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            Conversation.showNextButton();
                        };
                        audio.onerror = function(e) {
                            DebugLog.log('Audio error for step ' + State.step + ': ' + e.message);
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            Conversation.showNextButton();
                        };
                        audio.play().catch(function(e) {
                            DebugLog.log('Audio play failed for step ' + State.step + ': ' + e.message);
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            Conversation.showNextButton();
                        });
                    }
                }
            },

            showNextButton: function() {
                setTimeout(function() {
                    switch(State.step) {
                        case 0: // Welcome -> Show "Bereit"
                            DNAButton.showText('Bereit');
                            break;
                        case 1: // Why question -> Show answer choices
                            DNAButton.showAnswerChoices();
                            break;
                        case 2: // Goal question -> Show "Hold to speak"
                            DNAButton.showText('Hold to speak');
                            break;
                        case 3: // Time question -> Show time choices
                            DNAButton.showTimeChoices();
                            break;
                        case 4: // Probability question -> Show probability choices
                            DNAButton.showProbabilityChoices();
                            break;
                        case 5: // Mother question -> Show "Hold to speak"
                            DNAButton.showText('Hold to speak');
                            // Auto-interrupt after 7 seconds handled in hold function
                            break;
                        case 6: // Michael introduction -> Show "Ja"
                            DNAButton.showText('Ja');
                            break;
                        case 7: // Final question -> Show "Hold to speak"
                            DNAButton.showText('Hold to speak');
                            break;
                        case 8: // Final sequence
                            if (!State.inFinalSequence) {
                                State.inFinalSequence = true;
                                setTimeout(function() { Conversation.playFinalSequence(); }, 2000);
                            }
                            break;
                        case 9: // Very end -> Show "Na gut."
                            DNAButton.showText('Na gut.');
                            break;
                    }
                }, 1000);
            },

            playFinalSequence: function() {
                DebugLog.log('Starting final sequence');
                State.isSpeaking = true;
                UI.setVisualizerState('speaking');
                UI.updateProgress(90);
                if (WebAudioHelper.isMobile && State.audioUnlocked && window.AudioContext) {
                    WebAudioHelper.play(
                        State.finalThankYouAudio,
                        function() {
                            DebugLog.log('Final audio ended, waiting 7 seconds...');
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            setTimeout(function() {
                                State.step = 9;
                                UI.updateProgress(100);
                                DNAButton.showText('Na gut.');
                            }, 7000);
                        },
                        function(e) {
                            DebugLog.log('Final audio error: ' + (e && e.message));
                            State.isSpeaking = false;
                            setTimeout(function() {
                                State.step = 9;
                                DNAButton.showText('Na gut.');
                            }, 7000);
                        }
                    );
                } else {
                    var finalAudio = new Audio(State.finalThankYouAudio);
                    finalAudio.onended = function() {
                        DebugLog.log('Final audio ended, waiting 7 seconds...');
                        State.isSpeaking = false;
                        UI.setVisualizerState('active');
                        setTimeout(function() {
                            State.step = 9;
                            UI.updateProgress(100);
                            DNAButton.showText('Na gut.');
                        }, 7000);
                    };
                    finalAudio.onerror = function() {
                        DebugLog.log('Final audio error');
                        State.isSpeaking = false;
                        setTimeout(function() {
                            State.step = 9;
                            DNAButton.showText('Na gut.');
                        }, 7000);
                    };
                    finalAudio.play().catch(function(e) {
                        DebugLog.log('Final audio play failed: ' + e.message);
                        setTimeout(function() {
                            State.step = 9;
                            DNAButton.showText('Na gut.');
                        }, 7000);
                    });
                }
            },

            completeCourse: function() {
                DebugLog.log('Course completion triggered');
                setTimeout(function() {
                    var buttons = document.querySelectorAll('button, .btn, [role="button"]');
                    DebugLog.log('Found ' + buttons.length + ' potential completion buttons');
                    for (var i = 0; i < buttons.length; i++) {
                        var btn = buttons[i];
                        var text = btn.textContent.toLowerCase();
                        if (text.indexOf('complete') !== -1 || text.indexOf('continue') !== -1 || text.indexOf('next') !== -1) {
                            DebugLog.log('Clicking button: ' + text);
                            btn.click();
                            return;
                        }
                    }
                    DebugLog.log('No completion button found');
                }, 2000);
            },

            startQ1: function() {
                // Desktop-only flow (mobile already started voice)
                var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                if (isMobile && State.mobileAudioStarted) {
                    DebugLog.log('ðŸ“± Mobile: startQ1 skipped (voice already playing)');
                    return;
                }
                DebugLog.log('ðŸ–¥ï¸ Desktop: Starting first question normally');
                UI.setVisualizerState('active');
                UI.updateProgress(5);
                State.step = 0;
                // Play the welcome audio for desktop
                var url = State.audioFiles[0];
                // Set DNA to 'speaking' while audio is playing, then 'active' after
                UI.setVisualizerState('speaking');
                if (window.AudioContext && WebAudioHelper) {
                    WebAudioHelper.play(url, function() {
                        DebugLog.log('Audio ended for welcome message');
                        UI.setVisualizerState('active');
                        setTimeout(function() { DNAButton.showText('Bereit'); }, 2000);
                    }, function(e) {
                        DebugLog.log('Audio error for welcome message: ' + (e && e.message));
                        UI.setVisualizerState('active');
                        setTimeout(function() { DNAButton.showText('Bereit'); }, 2000);
                    });
                } else {
                    var audio = new Audio(url);
                    audio.onended = function() {
                        DebugLog.log('Audio ended for welcome message (HTML5 fallback)');
                        UI.setVisualizerState('active');
                        setTimeout(function() { DNAButton.showText('Bereit'); }, 2000);
                    };
                    audio.onerror = function(e) {
                        DebugLog.log('Audio error for welcome message (HTML5 fallback): ' + (e && e.message));
                        UI.setVisualizerState('active');
                        setTimeout(function() { DNAButton.showText('Bereit'); }, 2000);
                    };
                    audio.play();
                }
            }
        };

        var SG1 = {
            musicEnabled: true,
            
            toggleMusic: function() {
                DebugLog.log('Music toggle clicked, current state: ' + this.musicEnabled);
                
                var music = UI.element('backgroundMusic');
                var indicator = UI.element('musicIndicator');
                
                if (this.musicEnabled) {
                    if (music) {
                        music.pause();
                        DebugLog.log('Music paused');
                    }
                    if (indicator) indicator.classList.add('off');
                    this.musicEnabled = false;
                } else {
                    if (music) {
                        var playPromise = music.play();
                        if (playPromise) {
                            playPromise.then(function() {
                                DebugLog.log('Music resumed successfully');
                            }).catch(function(e) {
                                DebugLog.log('Music resume failed: ' + e.message);
                            });
                        }
                    }
                    if (indicator) indicator.classList.remove('off');
                    this.musicEnabled = true;
                }
                
                DebugLog.log('Music state changed to: ' + this.musicEnabled);
            },
            
            beginInitialization: function() {
                DebugLog.log('=== INITIALIZATION STARTED ===');
                DebugLog.log('User agent: ' + navigator.userAgent);
                DebugLog.log('[DEBUG] beginInitialization called');
                var preInitButton = document.querySelector('.pre-init-button');
                if (preInitButton) {
                    preInitButton.style.transform = 'scale(0.95)';
                    preInitButton.style.opacity = '0.7';
                    preInitButton.textContent = 'Starting...';
                }
                var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                DebugLog.log('Device type: ' + (isMobile ? 'Mobile' : 'Desktop'));
                DebugLog.log('[DEBUG] About to attempt audio unlock.');
                // CRITICAL: Use button click to unlock autoplay permissions
                var unlockAudio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiI2OvKcyMFl2+z9N2aPAIbWr9yxmAXGFnj8MJzJQUYYbf2xGIYG1nq6MJzJQUYlGt19Mhvaz5gXFztw2kdA0qP2uzGeTYFG3a36Pn0YlFmdXTs8bHnzLqLh6uYfJBaRoZ1puLsxXEvCSdtytNdKAkzWLz6qHNxMEOw6MtbKhJLkM/d3QBVL9JKR5X2QQAwfOYTM8cVkPB29ppqOZN17+o1GAbSrAXvOK9qVsO2P2bfyXU5aOPYqE+TKYeKc1PEJd+7L2XKHOd6d1qTKZ2pXPHZq36DWdF4VJOhJr6l9YNkFJdFaLyJRjF7X1lGf61O2FO8gY0n');
                unlockAudio.volume = 0.01;
                unlockAudio.onplay = function() { DebugLog.log('[DEBUG] unlockAudio onplay fired'); };
                unlockAudio.onended = function() { DebugLog.log('[DEBUG] unlockAudio onended fired'); };
                unlockAudio.onerror = function(e) { DebugLog.log('[DEBUG] unlockAudio onerror: ' + (e && e.message)); };
                unlockAudio.oncanplaythrough = function() { DebugLog.log('[DEBUG] unlockAudio oncanplaythrough fired'); };
                unlockAudio.play().then(function() {
                    DebugLog.log('âœ… Autoplay permissions unlocked for page!');
                    State.audioUnlocked = true;
                    DebugLog.log('[DEBUG] State.audioUnlocked set to true');
                    // Immediately create and resume the global AudioContext in the same gesture
                    try {
                        if (!window.globalAudioContext && window.AudioContext) {
                            window.globalAudioContext = new AudioContext();
                            DebugLog.log('[SG1.beginInitialization] Created globalAudioContext after unlock');
                        }
                        if (window.globalAudioContext && window.globalAudioContext.state === 'suspended') {
                            window.globalAudioContext.resume().then(function() {
                                DebugLog.log('[SG1.beginInitialization] globalAudioContext resumed after unlock');
                            }).catch(function(e) {
                                DebugLog.log('[SG1.beginInitialization] globalAudioContext resume failed: ' + (e && e.message));
                            });
                        }
                    } catch (e) {
                        DebugLog.log('[SG1.beginInitialization] Failed to create/resume globalAudioContext: ' + (e && e.message));
                    }
                }).catch(function(e) {
                    DebugLog.log('âŒ Autoplay unlock failed: ' + e.message);
                    State.audioUnlocked = false;
                    DebugLog.log('[DEBUG] State.audioUnlocked set to false');
                });
                DebugLog.log('[DEBUG] unlockAudio.play() called');
                
                // Start background music immediately (both mobile and desktop)
                var music = UI.element('backgroundMusic');
                if (music && SG1.musicEnabled) {
                    DebugLog.log('ðŸŽµ Starting background music immediately');
                    music.volume = 0.3;
                    music.play().then(function() {
                        DebugLog.log('âœ… Background music started immediately!');
                    }).catch(function(e) {
                        DebugLog.log('âŒ Background music failed: ' + e.message);
                    });
                }
                
                // MOBILE-SPECIFIC: Play a silent audio buffer immediately to keep audio unlocked, then play real audio after DNA fade-in
                if (isMobile) {
                    DebugLog.log('ðŸš¨ MOBILE: Playing silent buffer with Web Audio API to keep audio unlocked...');
                    try {
                        var ctx = window.globalAudioContext || (window.AudioContext ? new AudioContext() : null);
                        if (ctx) {
                            var buffer = ctx.createBuffer(1, 1, 22050);
                            var source = ctx.createBufferSource();
                            source.buffer = buffer;
                            source.connect(ctx.destination);
                            source.start(0);
                            DebugLog.log('âœ… Silent buffer played to keep audio unlocked');
                        } else {
                            DebugLog.log('âŒ No AudioContext available for silent unlock');
                        }
                    } catch (e) {
                        DebugLog.log('âŒ Silent buffer play failed: ' + (e && e.message));
                    }
                }
                
                // Continue with original timing for visual effects
                setTimeout(function() {
                    try {
                        if (document.documentElement.requestFullscreen) {
                            DebugLog.log('Requesting fullscreen...');
                            document.documentElement.requestFullscreen().then(function() {
                                DebugLog.log('âœ… Fullscreen activated successfully');
                            }).catch(function(e) {
                                DebugLog.log('âŒ Fullscreen request rejected: ' + e.message);
                            });
                        } else if (document.documentElement.webkitRequestFullscreen) {
                            DebugLog.log('Requesting webkit fullscreen...');
                            document.documentElement.webkitRequestFullscreen();
                        } else if (document.documentElement.mozRequestFullScreen) {
                            DebugLog.log('Requesting moz fullscreen...');
                            document.documentElement.mozRequestFullScreen();
                        } else {
                            DebugLog.log('âŒ No fullscreen API available');
                        }
                    } catch (e) {
                        DebugLog.log('âŒ Fullscreen request failed: ' + e.message);
                    }
                    
                    UI.hideElement('preInitOverlay');
                    UI.showElement('initOverlay');
                    
                    SG1.startInitialization();
                }, 300);
            },

            startInitialization: function() {
                DebugLog.log('Starting logo animation sequence');
                
                var logo = document.querySelector('.init-logo');
                var status = UI.element('statusText');
                
                if (status) status.textContent = 'Audio system ready. Loading voice...';
                
                if (logo) {
                    logo.style.opacity = '0';
                    logo.style.animation = 'none';
                    logo.style.transform = 'translate(-50%, -50%) scale(0.8)';
                    
                    setTimeout(function() {
                        if (status) {
                            status.textContent = 'Voice system online. Starting sequence...';
                            // Fade out after 2 seconds
                            setTimeout(function() {
                                status.style.transition = 'opacity 1s ease-out';
                                status.style.opacity = '0';
                            }, 2000);
                        }
                        
                        DebugLog.log('Starting SG1 logo animation');
                        logo.style.animation = 'sg1LogoFade 13s ease-in-out forwards';
                        
                        // Backup visibility check
                        setTimeout(function() {
                            if (logo.style.opacity === '0') {
                                DebugLog.log('Logo backup: forcing visibility');
                                logo.style.opacity = '1';
                                logo.style.transform = 'translate(-50%, -50%) scale(1)';
                                
                                setTimeout(function() {
                                    logo.style.opacity = '0';
                                }, 8000);
                            }
                        }, 3000);
                        
                        setTimeout(function() {
                            logo.style.opacity = '0';
                            logo.style.display = 'none';
                        }, 12000);
                        
                    }, 1000);
                } else {
                    DebugLog.log('ERROR: Logo element not found');
                }
                
                setTimeout(function() {
                    if (status) status.textContent = 'Loading neural interface...';
                    DebugLog.log('Showing DNA visualizer');
                    UI.showElement('visualizer');
                    // Gentle fade in DNA
                    var visualizer = UI.element('visualizer');
                    if (visualizer) {
                        visualizer.style.opacity = '0';
                        visualizer.style.transition = 'opacity 4s ease-in';
                        setTimeout(function() {
                            visualizer.style.opacity = '1';
                        }, 100);
                    }
                    // --- Move mobile audio playback here, after DNA fade-in starts ---
                    var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                    if (isMobile && !State.mobileAudioStarted) {
                        DebugLog.log('ðŸš¨ MOBILE: Delaying audio playback until DNA visualizer is visible...');
                        setTimeout(function() {
                            DebugLog.log('ðŸŽµ NOW ATTEMPTING MOBILE AUDIO PLAYBACK (after DNA fade-in)...');
                            var mobileVoiceAudio = new Audio(State.audioFiles[0]);
                            DebugLog.log('ðŸŽµ Audio object created, URL: ' + State.audioFiles[0]);
                            mobileVoiceAudio.volume = 1.0;
                            mobileVoiceAudio.addEventListener('loadstart', function() { DebugLog.log('ðŸ“¡ Audio: Loading started'); });
                            mobileVoiceAudio.addEventListener('loadeddata', function() { DebugLog.log('ðŸ“¡ Audio: Data loaded'); });
                            mobileVoiceAudio.addEventListener('canplay', function() { DebugLog.log('ðŸ“¡ Audio: Can play'); });
                            mobileVoiceAudio.addEventListener('error', function(e) { DebugLog.log('ðŸš¨ Audio Error Event: ' + e.message); });
                            var playPromise = mobileVoiceAudio.play();
                            DebugLog.log('ðŸŽµ Play promise created: ' + (playPromise ? 'YES' : 'NO'));
                            if (playPromise) {
                                playPromise.then(function() {
                                    DebugLog.log('âœ… SUCCESS: Mobile audio started!');
                                    State.isSpeaking = true;
                                    State.step = 0;
                                    State.mobileAudioStarted = true;
                                    UI.setVisualizerState('speaking');
                                    mobileVoiceAudio.onended = function() {
                                        DebugLog.log('ðŸ Mobile audio ended');
                                        State.isSpeaking = false;
                                        UI.setVisualizerState('active');
                                        setTimeout(function() { DNAButton.showText('Bereit'); }, 1000);
                                    };
                                }).catch(function(e) {
                                    DebugLog.log('ðŸš¨ MOBILE AUDIO FAILED:');
                                    DebugLog.log('Error name: ' + e.name);
                                    DebugLog.log('Error message: ' + e.message);
                                    DebugLog.log('Error code: ' + (e.code || 'none'));
                                    // Don't show button immediately on error - let user try again
                                });
                            } else {
                                DebugLog.log('ðŸš¨ No play promise returned!');
                                // Don't show button immediately - let user try again
                            }
                        }, 4100); // Wait for DNA fade-in (4s) before playing audio
                    }
                }, 14000); // DNA appears at 14s (6s after logo ends at 8s - no overlap)

                setTimeout(function() {
                    if (status) status.textContent = 'Ready to begin...';
                    UI.hideElement('initOverlay');
                    setTimeout(function() {
                        Conversation.startQ1();
                    }, 500);
                }, 17000); // Voice starts at 17s (back to original timing)
            },

            init: function() {
                DebugLog.init();
                DebugLog.log('=== SG1 SYSTEM INIT ===');
                // Speech synthesis fully removed
                DebugLog.log('SG1 System ready');
            }
        };

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                SG1.init();
            });
        } else {
            SG1.init();
        }

        // Global error handler
        window.onerror = function(message, source, lineno, colno, error) {
            DebugLog.log('ERROR: ' + message + ' at line ' + lineno);
            if (error && error.stack) {
                DebugLog.log('STACK: ' + error.stack);
            }
            return false;
        };
</script>
</body>
</html>