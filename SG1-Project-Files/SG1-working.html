<!DOCTYPE html>
<html lang="en">
<head>
  <title>SG1 - AI-Setup</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SG1 - AI German Learning System</title>
    <style>
        /* ===== BASE STYLES ===== */
        body, html { margin: 0; padding: 0; height: 100%; background: none; }
        .sg1-container * { margin: 0; padding: 0; box-sizing: border-box; }

        .sg1-container { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999999;
            background: linear-gradient(-45deg, #4ecdc4, #45b7d1, #96ceb4, #ffecd2);
            background-size: 400% 400%; animation: sg1GradientShift 15s ease infinite;
            overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        @keyframes sg1GradientShift { 
            0% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
            100% { background-position: 0% 50%; } 
        }

        /* ===== OVERLAYS ===== */
        .overlay-base { position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; transition: opacity 1s ease-out; }

        .pre-init-overlay { 
            z-index: 2000; opacity: 1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }

        .init-overlay { 
            z-index: 1000; opacity: 0; pointer-events: none;
            background: none !important;
            transition: opacity 0.5s ease;
        }
        .init-overlay.visible { 
            opacity: 1; pointer-events: all;
            background: none !important;
        }
        .init-overlay.hidden { 
            opacity: 0; pointer-events: none; display: none !important;
            background: none !important;
        }

        /* ===== MUSIC INDICATOR ===== */
        .music-indicator { 
            position: fixed; top: 20px; right: 20px; 
            color: rgba(255, 255, 255, 0.7); 
            font-size: 14px; 
            cursor: pointer; 
            user-select: none; 
            z-index: 10000;
            transition: color 0.3s ease;
        }
        .music-indicator:hover { 
            color: rgba(255, 255, 255, 1); 
        }
        .music-indicator.off { 
            text-decoration: line-through; 
        }

        /* ===== BUTTONS ===== */
        .pre-init-button { background: #4ecdc4; color: white; border: none; padding: 20px 40px;
            border-radius: 15px; font-size: 1.2em; font-weight: 500; letter-spacing: 1px; cursor: pointer;
            transition: all 0.4s ease; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); display: inline-block; }
        .pre-init-button:hover { background: #45b7d1; transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); }

        .bereit-button, .hold-speak-button, .ja-button, .na-gut-button {
            position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%);
            color: white; border: none; padding: 18px 40px; border-radius: 25px;
            font-size: clamp(16px, 4vw, 18px); 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            font-weight: 500; letter-spacing: 1px; cursor: pointer;
            min-width: 140px; min-height: 50px; 
            opacity: 0; transition: opacity 0.6s ease, transform 0.6s ease; pointer-events: none;
            backdrop-filter: blur(10px); z-index: 100;
            box-shadow: 0 8px 25px rgba(76, 205, 196, 0.3), 0 0 0 2px rgba(255, 255, 255, 0.2);
        }

        .bereit-button { background: linear-gradient(135deg, #4ecdc4, #45b7d1); }
        .bereit-button:hover { background: linear-gradient(135deg, #45b7d1, #4ecdc4); transform: translateX(-50%) translateY(-3px); }

        .hold-speak-button { background: linear-gradient(135deg, #ff8a65, #ff7043); user-select: none; }
        .hold-speak-button:hover { background: linear-gradient(135deg, #ff7043, #ff5722); transform: translateX(-50%) translateY(-3px); }
        .hold-speak-button.holding { background: linear-gradient(135deg, #ffca28, #ffd54f); transform: translateX(-50%) translateY(-1px) scale(0.98); }

        .ja-button { 
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            min-width: 80px; min-height: 50px; 
            padding: 12px 24px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ja-button:hover { 
            background: linear-gradient(135deg, #66bb6a, #4caf50); 
            transform: translateX(-50%) translateY(-3px); 
        }

        .na-gut-button { background: linear-gradient(135deg, #e91e63, #f06292); }
        .na-gut-button:hover { background: linear-gradient(135deg, #f06292, #e91e63); transform: translateX(-50%) translateY(-3px); }

        .bereit-button.visible, .hold-speak-button.visible, .ja-button.visible, .na-gut-button.visible,
        .answer-button.visible {
            opacity: 1; pointer-events: all;
        }

        /* ===== ANSWER BUTTONS (Q2) ===== */
        .answer-buttons-container {
            position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 20px;
            opacity: 0; transition: all 0.6s ease; pointer-events: none; z-index: 100;
            flex-wrap: wrap;
        }
        .answer-buttons-container.visible {
            opacity: 1; pointer-events: all;
        }

        .answer-button {
            color: white; border: none; padding: 15px 25px; border-radius: 20px;
            font-size: clamp(13px, 3vw, 15px); 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            font-weight: 500; letter-spacing: 0.5px; cursor: pointer;
            min-width: 160px; min-height: 45px; 
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 6px 20px rgba(76, 205, 196, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.15);
            position: relative; overflow: visible;
        }

        .answer-button-1 { background: linear-gradient(135deg, #4ecdc4, #45b7d1); }
        .answer-button-2 { background: linear-gradient(135deg, #ff8a65, #ff7043); }
        .answer-button-3 { background: linear-gradient(135deg, #9c27b0, #e91e63); }

        .answer-button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(76, 205, 196, 0.4), 0 0 0 2px rgba(255, 255, 255, 0.25);
        }

        .answer-translation {
            position: absolute; top: -45px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95); color: #333;
            padding: 8px 15px; border-radius: 15px; font-size: 13px;
            font-family: 'Helvetica Neue', Arial, sans-serif; font-weight: 300; letter-spacing: 0.5px;
            opacity: 0; transition: all 0.3s ease; pointer-events: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            white-space: nowrap; z-index: 1000;
        }
        /* ===== TIME ANSWER BUTTONS (Q4) ===== */
        .time-buttons-container {
            position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 20px;
            opacity: 0; transition: all 0.6s ease; pointer-events: none; z-index: 100;
            flex-wrap: wrap;
        }
        .time-buttons-container.visible {
            opacity: 1; pointer-events: all;
        }

        .time-button {
            color: white; border: none; padding: 15px 25px; border-radius: 20px;
            font-size: clamp(14px, 3.5vw, 16px); 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            font-weight: 500; letter-spacing: 0.5px; cursor: pointer;
            min-width: 100px; min-height: 45px; 
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 6px 20px rgba(76, 205, 196, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.15);
            position: relative; overflow: visible;
        }

        .time-button-1 { background: linear-gradient(135deg, #4ecdc4, #45b7d1); }
        .time-button-2 { background: linear-gradient(135deg, #ff8a65, #ff7043); }
        .time-button-3 { background: linear-gradient(135deg, #9c27b0, #e91e63); }

        .time-button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(76, 205, 196, 0.4), 0 0 0 2px rgba(255, 255, 255, 0.25);
        }

        /* ===== PROBABILITY ANSWER BUTTONS (Q5) ===== */
        .probability-buttons-container {
            position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 20px;
            opacity: 0; transition: all 0.6s ease; pointer-events: none; z-index: 100;
            flex-wrap: wrap;
        }
        .probability-buttons-container.visible {
            opacity: 1; pointer-events: all;
        }

        .probability-button {
            color: white; border: none; padding: 15px 25px; border-radius: 20px;
            font-size: clamp(14px, 3.5vw, 16px); 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            font-weight: 500; letter-spacing: 0.5px; cursor: pointer;
            min-width: 100px; min-height: 45px; 
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 6px 20px rgba(76, 205, 196, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.15);
            position: relative; overflow: visible;
        }

        .probability-button-1 { background: linear-gradient(135deg, #f44336, #e57373); }
        .probability-button-2 { background: linear-gradient(135deg, #ff9800, #ffb74d); }
        .probability-button-3 { background: linear-gradient(135deg, #4caf50, #81c784); }

        .probability-button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(76, 205, 196, 0.4), 0 0 0 2px rgba(255, 255, 255, 0.25);
        }

        .answer-button:hover .answer-translation,
        .answer-button:active .answer-translation,
        .answer-button:focus .answer-translation {
            opacity: 1; transform: translateX(-50%) translateY(-5px);
        }

        /* ===== LOGO ANIMATION ===== */
        .init-logo { 
            font-size: clamp(5em, 20vw, 7.5em); font-weight: 100; color: white; letter-spacing: 3px;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            opacity: 0;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        @keyframes sg1LogoFade {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
        }

        /* ===== DNA VISUALIZER ===== */
        .voice-visualizer { 
            height: 120px; width: min(450px, 85vw); position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: flex; align-items: center; justify-content: center; opacity: 0;
        }

        .dna-container { 
            display: flex; align-items: center; justify-content: center;
            z-index: 1; position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); width: min(400px, 80vw); height: 80px;
            transform-style: preserve-3d; perspective: 1000px;
        }

        .dna-strand { 
            fill: none; stroke: white; stroke-width: 5; stroke-linecap: round;
            animation: sg1DNAFlow 5s linear infinite;
            transform-origin: 50% 50%;
            filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.3));
            opacity: 1;
        }
        .dna-strand:nth-child(2) { 
            animation-delay: 0.5s;
            filter: drop-shadow(1px 1px 3px rgba(0, 0, 0, 0.35));
        }
        .dna-strand:nth-child(3) { 
            animation-delay: 1s;
            filter: drop-shadow(1px 1px 4px rgba(0, 0, 0, 0.4));
        }

        @keyframes sg1DNAFlow {
            0% { transform: rotateX(0deg); }
            100% { transform: rotateX(360deg); }
        }

        /* RESTORED: Fast speaking animations */
        @keyframes sg1DNAFlowFast1 {
            0% { transform: rotateX(0deg); }
            20% { transform: rotateX(120deg); }
            40% { transform: rotateX(180deg); }
            70% { transform: rotateX(300deg); }
            100% { transform: rotateX(360deg); }
        }
        @keyframes sg1DNAFlowFast2 {
            0% { transform: rotateX(0deg); }
            30% { transform: rotateX(90deg); }
            50% { transform: rotateX(240deg); }
            80% { transform: rotateX(300deg); }
            100% { transform: rotateX(360deg); }
        }
        @keyframes sg1DNAFlowFast3 {
            0% { transform: rotateX(0deg); }
            15% { transform: rotateX(150deg); }
            60% { transform: rotateX(210deg); }
            85% { transform: rotateX(330deg); }
            100% { transform: rotateX(360deg); }
        }

        .speaking .dna-strand { 
            stroke-width: 6; 
        }
        .speaking .dna-strand:nth-child(1) { 
            animation: sg1DNAFlowFast1 0.7s ease-in-out infinite; 
        }
        .speaking .dna-strand:nth-child(2) { 
            animation: sg1DNAFlowFast2 0.5s ease-in-out infinite; 
        }
        .speaking .dna-strand:nth-child(3) { 
            animation: sg1DNAFlowFast3 0.6s ease-in-out infinite; 
        }

        .listening .dna-strand { 
            animation: sg1DNAFlow 2s linear infinite;
            stroke: #ffd54f;
            filter: drop-shadow(1px 1px 3px rgba(255, 213, 79, 0.4));
        }

        /* ===== PROGRESS BAR ===== */
        .progress-container { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: min(400px, 80vw); height: 4px; background: rgba(255, 255, 255, 0.2);
            border-radius: 2px; overflow: hidden; z-index: 50;
        }
        .progress-bar { 
            height: 100%; background: linear-gradient(90deg, #4ecdc4, #45b7d1);
            width: 0%; transition: width 1s ease; border-radius: 2px;
        }

        /* ===== DEBUG LOG (COMMENTED OUT) ===== */
        /*
        .debug-log { 
            position: fixed; bottom: 0; left: 0; 
            background: rgba(255, 0, 0, 0.9) !important; 
            color: #ffffff !important; 
            font-family: monospace; 
            font-size: 14px !important; 
            font-weight: bold !important;
            padding: 15px !important; 
            max-height: 250px; 
            overflow-y: auto; 
            z-index: 99999 !important; 
            width: 100% !important;
            display: block !important;
            border-top: 3px solid #ffffff !important;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.5) !important;
        }
        .debug-log.visible { 
            display: block !important; 
        }
        */

        /* ===== UTILITY ===== */
        .hidden { opacity: 0 !important; pointer-events: none !important; }
        .visible { opacity: 1 !important; pointer-events: all !important; }
        .active { display: flex !important; }
    </style>
</head>
<body>
    <div class="sg1-container">
        <!-- Music indicator on all screens -->
        <div class="music-indicator" id="musicIndicator" onclick="SG1.toggleMusic()">music</div>

        <div class="pre-init-overlay overlay-base" id="preInitOverlay">
            <button class="pre-init-button" onclick="SG1.beginInitialization()">Initiate AI</button>
        </div>

        <div class="init-overlay overlay-base" id="initOverlay">
            <div class="init-logo">SG1</div>
            <div style="position: absolute; bottom: 100px; color: white; font-size: 16px; opacity: 0.8;" id="statusText">Initializing audio system...</div>
        </div>

        <div class="voice-visualizer" id="visualizer">
            <div class="dna-container">
                <svg width="100%" height="80" viewBox="0 0 400 80">
                    <path class="dna-strand" d="M0,40 Q50,15 100,40 Q150,65 200,40 Q250,15 300,40 Q350,65 400,40" />
                    <path class="dna-strand" d="M0,40 Q50,65 100,40 Q150,15 200,40 Q250,65 300,40 Q350,15 400,40" />
                    <path class="dna-strand" d="M0,40 Q50,15 100,40 Q150,65 200,40 Q250,15 300,40 Q350,65 400,40" />
                </svg>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="bereit-button" id="bereitButton" onclick="Conversation.handleBereit()">Bereit</div>
        <div class="hold-speak-button" id="holdSpeakButton" 
             onmousedown="Conversation.startHolding()" 
             onmouseup="Conversation.stopHolding()"
             ontouchstart="Conversation.startHolding()" 
             ontouchend="Conversation.stopHolding()">Hold to speak</div>
        <div class="ja-button" id="jaButton" onclick="Conversation.handleJa()">Ja</div>
        <div class="na-gut-button" id="naGutButton" onclick="Conversation.handleNaGut()">Na gut.</div>

        <!-- Answer buttons for Q2 -->
        <div class="answer-buttons-container" id="answerButtonsContainer">
            <button class="answer-button answer-button-1" onclick="Conversation.handleAnswerButton()">
                Gute Frage
                <div class="answer-translation">Good question</div>
            </button>
            <button class="answer-button answer-button-2" onclick="Conversation.handleAnswerButton()">
                Das geht Dich gar nichts an
                <div class="answer-translation">That's none of your business</div>
            </button>
            <button class="answer-button answer-button-3" onclick="Conversation.handleAnswerButton()">
                Keine Ahnung
                <div class="answer-translation">No idea</div>
            </button>
        </div>

        <!-- Time commitment buttons for Q4 -->
        <div class="time-buttons-container" id="timeButtonsContainer">
            <button class="time-button time-button-1" onclick="Conversation.handleTimeButton()">1h/w</button>
            <button class="time-button time-button-2" onclick="Conversation.handleTimeButton()">5hrs/w</button>
            <button class="time-button time-button-3" onclick="Conversation.handleTimeButton()">15hrs/w</button>
        </div>

        <!-- Probability buttons for Q5 -->
        <div class="probability-buttons-container" id="probabilityButtonsContainer">
            <button class="probability-button probability-button-1" onclick="Conversation.handleProbabilityButton('low')">&lt;50%</button>
            <button class="probability-button probability-button-2" onclick="Conversation.handleProbabilityButton('medium')">80%</button>
            <button class="probability-button probability-button-3" onclick="Conversation.handleProbabilityButton('high')">100%</button>
        </div>

        <!-- Background music -->
        <audio id="backgroundMusic" loop preload="auto">
            <source src="https://uploads.teachablecdn.com/attachments/1b02582168af4a60adcfc9dc91660d37.mp3" type="audio/mpeg">
        </audio>
    </div>

    <!-- Debug log (COMMENTED OUT) -->
    <!--
    <div class="debug-log" id="debugLog" style="user-select: text;">
        <button id="copyDebugLogBtn" style="position:absolute;top:8px;right:16px;z-index:100001;background:#fff;color:#c00;border:none;padding:6px 14px;border-radius:6px;font-size:14px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.08);">Copy All</button>
        <div id="debugLogText" style="min-height:60px;white-space:pre-wrap;word-break:break-word;"></div>
    </div>
    -->

<script>
/*
// Add Copy Log button above the debug textarea (COMMENTED OUT)
(function(){
    var btn = document.createElement('button');
    btn.id = 'copyDebugLogBtn';
    btn.textContent = 'Copy Log';
    btn.style.position = 'fixed';
    btn.style.bottom = '130px';
    btn.style.right = '20px';
    btn.style.zIndex = '2147483647';
    btn.style.background = '#fff';
    btn.style.color = '#c00';
    btn.style.border = '1px solid #c00';
    btn.style.padding = '8px 18px';
    btn.style.borderRadius = '8px';
    btn.style.fontSize = '15px';
    btn.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
    btn.style.cursor = 'pointer';
    btn.onclick = function() {
        var ta = document.getElementById('debugLogTextArea');
        if (ta) {
            ta.select();
            ta.setSelectionRange(0, ta.value.length);
            try {
                var ok = document.execCommand('copy');
                if (ok) {
                    btn.textContent = 'Copied!';
                    setTimeout(function(){btn.textContent='Copy Log';}, 1200);
                }
            } catch(e) {
                btn.textContent = 'Failed';
                setTimeout(function(){btn.textContent='Copy Log';}, 1200);
            }
        }
    };
    document.body.appendChild(btn);
    // Ensure button stays on top after fullscreen
    function ensureCopyBtnAfterFullscreen() {
        btn.style.zIndex = '2147483647';
        btn.style.display = 'block';
    }
    document.addEventListener('fullscreenchange', ensureCopyBtnAfterFullscreen);
    document.addEventListener('webkitfullscreenchange', ensureCopyBtnAfterFullscreen);
    document.addEventListener('mozfullscreenchange', ensureCopyBtnAfterFullscreen);
    document.addEventListener('MSFullscreenChange', ensureCopyBtnAfterFullscreen);
})();
*/

        // ===== DEBUG SYSTEM (COMMENTED OUT) =====
        /*
        var DebugLog = {
            messages: [],
            textArea: null,
            ensureTextArea: function() {
                if (!this.textArea) {
                    var ta = document.getElementById('debugLogTextArea');
                    if (!ta) {
                        ta = document.createElement('textarea');
                        ta.id = 'debugLogTextArea';
                        ta.value = 'Debug log will appear here...';
                        ta.readOnly = false;
                        ta.style.position = 'fixed';
                        ta.style.bottom = '0';
                        ta.style.left = '0';
                        ta.style.width = '100vw';
                        ta.style.height = '120px';
                        ta.style.zIndex = '2147483647';
                        ta.style.background = '#fff0f0';
                        ta.style.color = '#c00';
                        ta.style.fontFamily = 'monospace';
                        ta.style.fontSize = '14px';
                        ta.style.padding = '10px';
                        ta.style.boxSizing = 'border-box';
                        ta.style.resize = 'vertical';
                        ta.style.opacity = '0.98';
                        ta.style.pointerEvents = 'auto';
                        document.body.appendChild(ta);
                    }
                    this.textArea = ta;
                }
            },
            
            init: function() {
                this.ensureTextArea();
                if (this.textArea) {
                    this.textArea.style.display = 'block';
                    this.textArea.readOnly = false;
                }
                window.__DEBUGLOG_INIT = true;
                DebugLog.log('üö® DEBUG PANEL ACTIVE - YOU SHOULD SEE THIS');
                var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                if (isMobile) {
                    DebugLog.log('üì± MOBILE DEVICE DETECTED');
                } else {
                    DebugLog.log('üñ•Ô∏è DESKTOP DEVICE DETECTED');
                }
                setTimeout(function(){
                    if (DebugLog.messages.length < 2) {
                        DebugLog.log('‚ö†Ô∏è DebugLog is initialized but no logs have been written. If you see this, JS may not be running as expected.');
                    }
                }, 2000);
            },
            
            log: function(message) {
                this.ensureTextArea();
                var timestamp = new Date().toLocaleTimeString();
                var logMessage = '[' + timestamp + '] ' + String(message);
                try { console.log(logMessage); } catch(e){}
                this.messages.push(logMessage);
                if (this.textArea) {
                    this.textArea.value = this.messages.slice(-50).join('\n');
                    this.textArea.scrollTop = this.textArea.scrollHeight;
                }
            },
            
            show: function() {
                if (this.element) {
                    this.element.classList.add('visible');
                }
            },
            
            hide: function() {
                if (this.element) {
                    this.element.classList.remove('visible');
                }
            }
        };
        */

        // Simple console-only debug replacement
        var DebugLog = {
            log: function(message) {
                var timestamp = new Date().toLocaleTimeString();
                var logMessage = '[' + timestamp + '] ' + String(message);
                try { console.log(logMessage); } catch(e){}
            },
            init: function() {
                console.log('=== DEBUG SYSTEM INITIALIZED (CONSOLE ONLY) ===');
            }
        };

        var State = {
            step: 0,
            isSpeaking: false,
            motherInterruptTimer: null,
            inFinalSequence: false,
            audioUnlocked: false,
            mobileAudioStarted: false,
            
            audioFiles: {
                0: 'https://uploads.teachablecdn.com/attachments/fa6567b6d8e64c3dbb04265db8f4b44f.mp3',
                1: 'https://uploads.teachablecdn.com/attachments/91dd16c7d1c64ce6afb59a1d72ded03b.mp3',
                2: 'https://uploads.teachablecdn.com/attachments/e37c338dcbe745859c45484d45f14666.mp3',
                3: 'https://uploads.teachablecdn.com/attachments/54355724a83d440cb199271eafe57e24.mp3',
                4: 'https://uploads.teachablecdn.com/attachments/95631cf6057642709b18f5902c511958.mp3',
                5: 'https://uploads.teachablecdn.com/attachments/e85d721b671746169040af93a4aa37b1.mp3',
                6: 'https://uploads.teachablecdn.com/attachments/ac76bcc7a7dd4544b0364e277ceb0970.mp3',
                7: 'https://uploads.teachablecdn.com/attachments/0cdfc0ce7a3245618d7fed8ce25d7d3b.mp3',
                8: 'https://uploads.teachablecdn.com/attachments/28a3453828b247529b17c6cfc0cc745c.mp3'
            },
            
            thankYouAudio: 'https://uploads.teachablecdn.com/attachments/4e2906fba5dc40e6bd0d294332e94123.mp3',
            finalThankYouAudio: 'https://uploads.teachablecdn.com/attachments/8f1a13b6a0e14abb885ef5f979d3d6c7.mp3',
            
            questions: [
                "Welcome to the world's first artificially intelligent German Course system, SG1.",
                "Why do you want to learn German? I mean seriously: WHY?",
                "What's your goal? Where do you want to be with your German after what amount of time?",
                "How much time do you plan to spend on your German?",
                "How probable is it that you will reach your goal?",
                "How would you describe your relationship with your mother?",
                "Hi there. My name is Michael. I'll be your instructor for the coming 23.5 years. But don't despair. Even the longest journey will come to an end eventually. Sooner or later. In your case rather later. Shall we begin?"
            ]
        };

        var UI = {
            element: function(id) { 
                return document.getElementById(id); 
            },
            
            showElement: function(id) { 
                var element = this.element(id);
                if (element) {
                    element.classList.remove('hidden');
                    element.classList.add('active', 'visible');
                    element.style.display = 'flex';
                    if (id === 'visualizer') {
                        element.style.opacity = '1';
                    }
                }
            },
            
            hideElement: function(id) { 
                var element = this.element(id);
                if (element) {
                    element.classList.remove('active', 'visible');
                    element.classList.add('hidden');
                }
            },
            
            setVisualizerState: function(state) { 
                var visualizer = this.element('visualizer');
                if (visualizer) {
                    visualizer.className = 'voice-visualizer active ' + state;
                    DebugLog.log('DNA visualizer state: ' + state);
                }
            },
            
            updateProgress: function(percentage) {
                var bar = this.element('progressBar');
                if (bar) bar.style.width = percentage + '%';
            },
            
            showBereitButton: function() {
                this.hideAllButtons();
                var button = this.element('bereitButton');
                if (button) {
                    button.classList.add('visible');
                    button.style.opacity = '1';
                    button.style.pointerEvents = 'all';
                    button.style.display = 'flex';
                }
            },
            
            showHoldSpeakButton: function() {
                this.hideAllButtons();
                var button = this.element('holdSpeakButton');
                if (button) button.classList.add('visible');
            },
            
            showJaButton: function() {
                this.hideAllButtons();
                var button = this.element('jaButton');
                if (button) button.classList.add('visible');
            },
            
            showNaGutButton: function() {
                this.hideAllButtons();
                var button = this.element('naGutButton');
                if (button) button.classList.add('visible');
            },

            showAnswerButtons: function() {
                this.hideAllButtons();
                var container = this.element('answerButtonsContainer');
                if (container) container.classList.add('visible');
            },

            showTimeButtons: function() {
                this.hideAllButtons();
                var container = this.element('timeButtonsContainer');
                if (container) container.classList.add('visible');
            },

            showProbabilityButtons: function() {
                this.hideAllButtons();
                var container = this.element('probabilityButtonsContainer');
                if (container) container.classList.add('visible');
            },
            
            hideAllButtons: function() {
                var buttons = ['bereitButton', 'holdSpeakButton', 'jaButton', 'naGutButton'];
                for (var i = 0; i < buttons.length; i++) {
                    var button = this.element(buttons[i]);
                    if (button) button.classList.remove('visible');
                }
                var answerContainer = this.element('answerButtonsContainer');
                if (answerContainer) answerContainer.classList.remove('visible');
                var timeContainer = this.element('timeButtonsContainer');
                if (timeContainer) timeContainer.classList.remove('visible');
                var probabilityContainer = this.element('probabilityButtonsContainer');
                if (probabilityContainer) probabilityContainer.classList.remove('visible');
            }
        };

        var AudioManager = {
            tryStartBackgroundMusic: function() {
                if (!SG1.musicEnabled) {
                    DebugLog.log('Music disabled, skipping start');
                    return;
                }
                
                var music = UI.element('backgroundMusic');
                if (!music) {
                    DebugLog.log('ERROR: Background music element not found');
                    return;
                }
                
                DebugLog.log('Attempting to start background music...');
                DebugLog.log('Music element state: paused=' + music.paused + ', volume=' + music.volume);
                
                music.volume = 0.3;
                music.muted = false;
                
                var playPromise = music.play();
                if (playPromise) {
                    playPromise.then(function() {
                        DebugLog.log('‚úÖ Background music started successfully!');
                    }).catch(function(e) {
                        DebugLog.log('‚ùå Background music prevented: ' + e.name + ' - ' + e.message);
                    });
                } else {
                    DebugLog.log('‚ùå No play promise returned from music.play()');
                }
            },
            
            stopAllSpeech: function() {
                if (State.synthesis) State.synthesis.cancel();
            }
        };

        // --- Web Audio API helper for mobile ---
        var WebAudioHelper = {
            isMobile: /iPhone|iPad|iPod|Android/i.test(navigator.userAgent),
            buffers: {},
            currentSource: null,
            ensureContext: function() {
                if (!window.globalAudioContext && window.AudioContext) {
                    DebugLog.log('[WebAudioHelper] Creating global AudioContext');
                    window.globalAudioContext = new AudioContext();
                }
                if (window.globalAudioContext) DebugLog.log('[WebAudioHelper] globalAudioContext state: ' + window.globalAudioContext.state);
                return window.globalAudioContext;
            },
            load: function(url) {
                var self = this;
                DebugLog.log('[WebAudioHelper] load() called for: ' + url);
                var ctx = self.ensureContext();
                if (!ctx) {
                    DebugLog.log('[WebAudioHelper] No AudioContext available');
                    return Promise.reject();
                }
                if (self.buffers[url]) {
                    DebugLog.log('[WebAudioHelper] Buffer cache hit for: ' + url);
                    return Promise.resolve(self.buffers[url]);
                }
                DebugLog.log('[WebAudioHelper] Fetching and decoding: ' + url);
                return fetch(url)
                    .then(r => r.arrayBuffer())
                    .then(data => new Promise((resolve, reject) => {
                        ctx.decodeAudioData(data, function(buffer) {
                            DebugLog.log('[WebAudioHelper] Decoded buffer for: ' + url);
                            self.buffers[url] = buffer;
                            resolve(buffer);
                        }, function(e) {
                            DebugLog.log('[WebAudioHelper] decodeAudioData error: ' + (e && e.message));
                            reject(e);
                        });
                    }));
            },
            play: function(url, onended, onerror) {
                var self = this;
                DebugLog.log('[WebAudioHelper] play() called for: ' + url);
                self.load(url).then(function(buffer) {
                    var ctx = self.ensureContext();
                    DebugLog.log('[WebAudioHelper] Buffer ready for: ' + url);
                    DebugLog.log('[WebAudioHelper] globalAudioContext state before play: ' + ctx.state);
                    if (ctx.state === 'suspended') {
                        DebugLog.log('[WebAudioHelper] Resuming globalAudioContext...');
                        ctx.resume().then(function() {
                            DebugLog.log('[WebAudioHelper] globalAudioContext resumed. State: ' + ctx.state);
                            self._playBuffer(ctx, buffer, onended, onerror, url);
                        }).catch(function(e) {
                            DebugLog.log('[WebAudioHelper] globalAudioContext resume() failed: ' + (e && e.message));
                        });
                    } else {
                        self._playBuffer(ctx, buffer, onended, onerror, url);
                    }
                }).catch(function(e){
                    DebugLog.log('[WebAudioHelper] play() error: ' + (e && e.message));
                    if (onerror) onerror(e);
                });
            },
            _playBuffer: function(ctx, buffer, onended, onerror, url) {
                DebugLog.log('[WebAudioHelper] _playBuffer() for: ' + url);
                if (this.currentSource) {
                    DebugLog.log('[WebAudioHelper] Stopping previous source');
                    try { this.currentSource.onended = null; this.currentSource.stop(); } catch(e){ DebugLog.log('[WebAudioHelper] Error stopping previous source: ' + (e && e.message)); }
                    this.currentSource = null;
                }
                var source = ctx.createBufferSource();
                source.buffer = buffer;
                source.connect(ctx.destination);
                source.onended = function() {
                    DebugLog.log('[WebAudioHelper] onended fired for: ' + url);
                    if (onended) onended();
                };
                try {
                    DebugLog.log('[WebAudioHelper] Starting source for: ' + url);
                    source.start(0);
                } catch(e) {
                    DebugLog.log('[WebAudioHelper] Error starting source: ' + (e && e.message));
                    if (onerror) onerror(e);
                }
                this.currentSource = source;
            }
        };

        var Conversation = {
            handleBereit: function() {
                DebugLog.log('Bereit button clicked');
                // Immediately start fading out the button
                var button = UI.element('bereitButton');
                if (button) {
                    button.style.opacity = '0';
                    button.style.transform = 'translateX(-50%) translateY(10px)';
                    button.style.pointerEvents = 'none';
                }
                setTimeout(function() {
                    UI.hideAllButtons();
                    Conversation.moveToNextQuestion();
                }, 1000);
            },

            startHolding: function() {
                if (State.isSpeaking) return;
                
                DebugLog.log('Hold button pressed');
                var button = UI.element('holdSpeakButton');
                if (button) {
                    button.classList.add('holding');
                    button.textContent = 'Recording...';
                }
                
                UI.setVisualizerState('listening');
            },

            stopHolding: function() {
                DebugLog.log('Hold button released');
                var button = UI.element('holdSpeakButton');
                if (button) {
                    button.classList.remove('holding');
                    button.textContent = 'Hold to speak';
                }
                
                UI.setVisualizerState('active');
                
                if (State.motherInterruptTimer) {
                    clearTimeout(State.motherInterruptTimer);
                    State.motherInterruptTimer = null;
                }
                
                setTimeout(function() {
                    if (State.step === 5) {
                        Conversation.moveToNextQuestion();
                    } else {
                        Conversation.playThankYou();
                    }
                }, 500);
            },

            simulateInterruption: function() {
                DebugLog.log('Mother interruption triggered');
                var button = UI.element('holdSpeakButton');
                if (button) {
                    button.classList.remove('holding');
                    button.textContent = 'Hold to speak';
                }
                
                if (State.motherInterruptTimer) {
                    clearTimeout(State.motherInterruptTimer);
                    State.motherInterruptTimer = null;
                }
                
                UI.setVisualizerState('active');
                UI.hideAllButtons();
                
                setTimeout(function() {
                    if (State.step === 5) {
                        Conversation.moveToNextQuestion();
                    } else {
                        Conversation.playThankYou();
                    }
                }, 1000);
            },

            handleJa: function() {
                DebugLog.log('Ja button clicked');
                // Immediately start fading out the JA button
                var button = UI.element('jaButton');
                if (button) {
                    button.style.opacity = '0';
                    button.style.transform = 'translateX(-50%) translateY(10px)';
                    button.style.pointerEvents = 'none';
                }
                if (State.step === 6) {
                    setTimeout(function() {
                        UI.hideAllButtons();
                        Conversation.moveToNextQuestion();
                    }, 1000);
                }
            },

            handleNaGut: function() {
                DebugLog.log('Na gut button clicked');
                UI.hideAllButtons();
                this.completeCourse();
            },

            handleAnswerButton: function() {
                DebugLog.log('Answer button clicked');
                // Immediately start fading out the answer buttons
                var container = UI.element('answerButtonsContainer');
                if (container) {
                    container.style.opacity = '0';
                    container.style.transform = 'translateX(-50%) translateY(10px)';
                    container.style.pointerEvents = 'none';
                }
                setTimeout(function() {
                    UI.hideAllButtons();
                    Conversation.moveToNextQuestion();
                }, 1000);
            },

            handleTimeButton: function() {
                DebugLog.log('Time button clicked');
                // Immediately start fading out the time buttons
                var container = UI.element('timeButtonsContainer');
                if (container) {
                    container.style.opacity = '0';
                    container.style.transform = 'translateX(-50%) translateY(10px)';
                    container.style.pointerEvents = 'none';
                }
                setTimeout(function() {
                    UI.hideAllButtons();
                    Conversation.moveToNextQuestion();
                }, 1000);
            },

            handleProbabilityButton: function(level) {
                DebugLog.log('Probability button clicked: ' + level);
                
                // Immediately start fading out the probability buttons
                var container = UI.element('probabilityButtonsContainer');
                if (container) {
                    container.style.opacity = '0';
                    container.style.transform = 'translateX(-50%) translateY(10px)';
                    container.style.pointerEvents = 'none';
                }
                
                // Special handling for <50% option
                if (level === 'low') {
                    DebugLog.log('Low probability selected, opening external course');
                    setTimeout(function() {
                        window.open('https://smartergerman.com/courses/unblock-your-german/', '_blank');
                        UI.hideAllButtons();
                        // Still continue to next question after opening the link
                        Conversation.moveToNextQuestion();
                    }, 1000);
                } else {
                    setTimeout(function() {
                        UI.hideAllButtons();
                        Conversation.moveToNextQuestion();
                    }, 1000);
                }
            },

            playThankYou: function() {
                DebugLog.log('Playing thank you audio');
                State.isSpeaking = true;
                UI.setVisualizerState('speaking');
                if (WebAudioHelper.isMobile && State.audioUnlocked && window.AudioContext) {
                    WebAudioHelper.play(
                        State.thankYouAudio,
                        function() {
                            DebugLog.log('Thank you audio ended');
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                        },
                        function(e) {
                            DebugLog.log('Thank you audio error: ' + (e && e.message));
                            State.isSpeaking = false;
                            setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                        }
                    );
                } else {
                    var audio = new Audio(State.thankYouAudio);
                    audio.onended = function() {
                        DebugLog.log('Thank you audio ended');
                        State.isSpeaking = false;
                        UI.setVisualizerState('active');
                        setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                    };
                    audio.onerror = function(e) {
                        DebugLog.log('Thank you audio error: ' + e.message);
                        State.isSpeaking = false;
                        setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                    };
                    audio.play().catch(function(e) {
                        DebugLog.log('Thank you audio play failed: ' + e.message);
                        State.isSpeaking = false;
                        setTimeout(function() { Conversation.moveToNextQuestion(); }, 1000);
                    });
                }
            },

            moveToNextQuestion: function() {
                if (State.inFinalSequence && State.step >= 8) {
                    return;
                }
                
                State.step++;
                DebugLog.log('Moving to step ' + State.step);
                
                if (State.step >= State.questions.length) {
                    this.completeCourse();
                } else {
                    UI.updateProgress((State.step + 1) * 9);
                    
                    // Play the audio for the current step
                    State.isSpeaking = true;
                    UI.setVisualizerState('speaking');
                    
                    var audioUrl = State.audioFiles[State.step];
                    DebugLog.log('Playing audio for step ' + State.step + ': ' + audioUrl);
                    
                    if (WebAudioHelper.isMobile && State.audioUnlocked && window.AudioContext) {
                        WebAudioHelper.play(
                            audioUrl,
                            function() {
                                DebugLog.log('Audio ended for step ' + State.step);
                                State.isSpeaking = false;
                                UI.setVisualizerState('active');
                                Conversation.showNextButton();
                            },
                            function(e) {
                                DebugLog.log('Audio error for step ' + State.step + ': ' + (e && e.message));
                                State.isSpeaking = false;
                                UI.setVisualizerState('active');
                                Conversation.showNextButton();
                            }
                        );
                    } else {
                        var audio = new Audio(audioUrl);
                        audio.onended = function() {
                            DebugLog.log('Audio ended for step ' + State.step);
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            Conversation.showNextButton();
                        };
                        audio.onerror = function(e) {
                            DebugLog.log('Audio error for step ' + State.step + ': ' + e.message);
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            Conversation.showNextButton();
                        };
                        audio.play().catch(function(e) {
                            DebugLog.log('Audio play failed for step ' + State.step + ': ' + e.message);
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            Conversation.showNextButton();
                        });
                    }
                }
            },

            showNextButton: function() {
                setTimeout(function() {
                    if (State.step === 1) {
                        UI.showAnswerButtons();
                    } else if (State.step === 2) {
                        UI.showHoldSpeakButton();
                    } else if (State.step === 3) {
                        UI.showTimeButtons();
                    } else if (State.step === 4) {
                        UI.showProbabilityButtons();
                    } else if (State.step === 5) {
                        UI.showHoldSpeakButton();
                        State.motherInterruptTimer = setTimeout(function() { Conversation.simulateInterruption(); }, 7000);
                    } else if (State.step === 6) {
                        UI.showJaButton();
                    } else if (State.step === 7) {
                        UI.showHoldSpeakButton();
                    } else if (State.step === 8) {
                        if (!State.inFinalSequence) {
                            State.inFinalSequence = true;
                            setTimeout(function() { Conversation.playFinalSequence(); }, 2000);
                        }
                    } else if (State.step === 9) {
                        UI.showNaGutButton();
                    }
                }, 1000);
            },

            playFinalSequence: function() {
                DebugLog.log('Starting final sequence');
                State.isSpeaking = true;
                UI.setVisualizerState('speaking');
                UI.updateProgress(90);
                if (WebAudioHelper.isMobile && State.audioUnlocked && window.AudioContext) {
                    WebAudioHelper.play(
                        State.finalThankYouAudio,
                        function() {
                            DebugLog.log('Final audio ended, waiting 7 seconds...');
                            State.isSpeaking = false;
                            UI.setVisualizerState('active');
                            setTimeout(function() {
                                State.step = 9;
                                UI.updateProgress(100);
                                // ...audio playbook already handled, removed Speech.speak...
                            }, 7000);
                        },
                        function(e) {
                            DebugLog.log('Final audio error: ' + (e && e.message));
                            State.isSpeaking = false;
                            setTimeout(function() {
                                State.step = 6;
                                // ...audio playback already handled, removed Speech.speak...
                            }, 7000);
                        }
                    );
                } else {
                    var finalAudio = new Audio(State.finalThankYouAudio);
                    finalAudio.onended = function() {
                        DebugLog.log('Final audio ended, waiting 7 seconds...');
                        State.isSpeaking = false;
                        UI.setVisualizerState('active');
                        setTimeout(function() {
                            State.step = 6;
                            UI.updateProgress(100);
                            // ...audio playback already handled, removed Speech.speak...
                        }, 7000);
                    };
                    finalAudio.onerror = function() {
                        DebugLog.log('Final audio error');
                        State.isSpeaking = false;
                        setTimeout(function() {
                            State.step = 9;
                            // ...audio playback already handled, removed Speech.speak...
                        }, 7000);
                    };
                    finalAudio.play().catch(function(e) {
                        DebugLog.log('Final audio play failed: ' + e.message);
                        setTimeout(function() {
                            State.step = 6;
                            // ...audio playback already handled, removed Speech.speak...
                        }, 7000);
                    });
                }
            },

            completeCourse: function() {
                DebugLog.log('Course completion triggered');
                setTimeout(function() {
                    var buttons = document.querySelectorAll('button, .btn, [role="button"]');
                    DebugLog.log('Found ' + buttons.length + ' potential completion buttons');
                    for (var i = 0; i < buttons.length; i++) {
                        var btn = buttons[i];
                        var text = btn.textContent.toLowerCase();
                        if (text.indexOf('complete') !== -1 || text.indexOf('continue') !== -1 || text.indexOf('next') !== -1) {
                            DebugLog.log('Clicking button: ' + text);
                            btn.click();
                            return;
                        }
                    }
                    DebugLog.log('No completion button found');
                }, 2000);
            },

            startQ1: function() {
                // Desktop-only flow (mobile already started voice)
                var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                if (isMobile && State.mobileAudioStarted) {
                    DebugLog.log('üì± Mobile: startQ1 skipped (voice already playing)');
                    return;
                }
                DebugLog.log('üñ•Ô∏è Desktop: Starting first question normally');
                UI.setVisualizerState('active');
                UI.updateProgress(5);
                State.step = 0;
                // Play the welcome audio for desktop
                var url = State.audioFiles[0];
                // Set DNA to 'speaking' while audio is playing, then 'active' after
                UI.setVisualizerState('speaking');
                if (window.AudioContext && WebAudioHelper) {
                    WebAudioHelper.play(url, function() {
                        DebugLog.log('Audio ended for welcome message');
                        UI.setVisualizerState('active');
                        setTimeout(function() { UI.showBereitButton(); }, 2000);
                    }, function(e) {
                        DebugLog.log('Audio error for welcome message: ' + (e && e.message));
                        UI.setVisualizerState('active');
                        setTimeout(function() { UI.showBereitButton(); }, 2000);
                    });
                } else {
                    var audio = new Audio(url);
                    audio.onended = function() {
                        DebugLog.log('Audio ended for welcome message (HTML5 fallback)');
                        UI.setVisualizerState('active');
                        setTimeout(function() { UI.showBereitButton(); }, 2000);
                    };
                    audio.onerror = function(e) {
                        DebugLog.log('Audio error for welcome message (HTML5 fallback): ' + (e && e.message));
                        UI.setVisualizerState('active');
                        setTimeout(function() { UI.showBereitButton(); }, 2000);
                    };
                    audio.play();
                }
            }
        };

        var SG1 = {
            musicEnabled: true,
            
            toggleMusic: function() {
                DebugLog.log('Music toggle clicked, current state: ' + this.musicEnabled);
                
                var music = UI.element('backgroundMusic');
                var indicator = UI.element('musicIndicator');
                
                if (this.musicEnabled) {
                    if (music) {
                        music.pause();
                        DebugLog.log('Music paused');
                    }
                    if (indicator) indicator.classList.add('off');
                    this.musicEnabled = false;
                } else {
                    if (music) {
                        var playPromise = music.play();
                        if (playPromise) {
                            playPromise.then(function() {
                                DebugLog.log('Music resumed successfully');
                            }).catch(function(e) {
                                DebugLog.log('Music resume failed: ' + e.message);
                            });
                        }
                    }
                    if (indicator) indicator.classList.remove('off');
                    this.musicEnabled = true;
                }
                
                DebugLog.log('Music state changed to: ' + this.musicEnabled);
            },
            
            beginInitialization: function() {
                DebugLog.log('=== INITIALIZATION STARTED ===');
                DebugLog.log('User agent: ' + navigator.userAgent);
                DebugLog.log('[DEBUG] beginInitialization called');
                var preInitButton = document.querySelector('.pre-init-button');
                if (preInitButton) {
                    preInitButton.style.transform = 'scale(0.95)';
                    preInitButton.style.opacity = '0.7';
                    preInitButton.textContent = 'Starting...';
                }
                var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                DebugLog.log('Device type: ' + (isMobile ? 'Mobile' : 'Desktop'));
                DebugLog.log('[DEBUG] About to attempt audio unlock.');
                // CRITICAL: Use button click to unlock autoplay permissions
                var unlockAudio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiI2OvKcyMFl2+z9N2aPAIbWr9yxmAXGFnj8MJzJQUYYbf2xGIYG1nq6MJzJQUYlGt19Mhvaz5gXFztw2kdA0qP2uzGeTYFG3a36Pn0YlFmdXTs8bHnzLqLh6uYfJBaRoZ1puLsxXEvCSdtytNdKAkzWLz6qHNxMEOw6MtbKhJLkM/d3QBVL9JKR5X2QQAwfOYTM8cVkPB29ppqOZN17+o1GAbSrAXvOK9qVsO2P2bfyXU5aOPYqE+TKYeKc1PEJd+7L2XKHOd6d1qTKZ2pXPHZq36DWdF4VJOhJr6l9YNkFJdFaLyJRjF7X1lGf61O2FO8gY0n');
                unlockAudio.volume = 0.01;
                unlockAudio.onplay = function() { DebugLog.log('[DEBUG] unlockAudio onplay fired'); };
                unlockAudio.onended = function() { DebugLog.log('[DEBUG] unlockAudio onended fired'); };
                unlockAudio.onerror = function(e) { DebugLog.log('[DEBUG] unlockAudio onerror: ' + (e && e.message)); };
                unlockAudio.oncanplaythrough = function() { DebugLog.log('[DEBUG] unlockAudio oncanplaythrough fired'); };
                unlockAudio.play().then(function() {
                    DebugLog.log('‚úÖ Autoplay permissions unlocked for page!');
                    State.audioUnlocked = true;
                    DebugLog.log('[DEBUG] State.audioUnlocked set to true');
                    // Immediately create and resume the global AudioContext in the same gesture
                    try {
                        if (!window.globalAudioContext && window.AudioContext) {
                            window.globalAudioContext = new AudioContext();
                            DebugLog.log('[SG1.beginInitialization] Created globalAudioContext after unlock');
                        }
                        if (window.globalAudioContext && window.globalAudioContext.state === 'suspended') {
                            window.globalAudioContext.resume().then(function() {
                                DebugLog.log('[SG1.beginInitialization] globalAudioContext resumed after unlock');
                            }).catch(function(e) {
                                DebugLog.log('[SG1.beginInitialization] globalAudioContext resume failed: ' + (e && e.message));
                            });
                        }
                    } catch (e) {
                        DebugLog.log('[SG1.beginInitialization] Failed to create/resume globalAudioContext: ' + (e && e.message));
                    }
                }).catch(function(e) {
                    DebugLog.log('‚ùå Autoplay unlock failed: ' + e.message);
                    State.audioUnlocked = false;
                    DebugLog.log('[DEBUG] State.audioUnlocked set to false');
                });
                DebugLog.log('[DEBUG] unlockAudio.play() called');
                
                // Start background music immediately (both mobile and desktop)
                var music = UI.element('backgroundMusic');
                if (music && SG1.musicEnabled) {
                    DebugLog.log('üéµ Starting background music immediately');
                    music.volume = 0.3;
                    music.play().then(function() {
                        DebugLog.log('‚úÖ Background music started immediately!');
                    }).catch(function(e) {
                        DebugLog.log('‚ùå Background music failed: ' + e.message);
                    });
                }
                
                // MOBILE-SPECIFIC: Play a silent audio buffer immediately to keep audio unlocked, then play real audio after DNA fade-in
                if (isMobile) {
                    DebugLog.log('üö® MOBILE: Playing silent buffer with Web Audio API to keep audio unlocked...');
                    try {
                        var ctx = window.globalAudioContext || (window.AudioContext ? new AudioContext() : null);
                        if (ctx) {
                            var buffer = ctx.createBuffer(1, 1, 22050);
                            var source = ctx.createBufferSource();
                            source.buffer = buffer;
                            source.connect(ctx.destination);
                            source.start(0);
                            DebugLog.log('‚úÖ Silent buffer played to keep audio unlocked');
                        } else {
                            DebugLog.log('‚ùå No AudioContext available for silent unlock');
                        }
                    } catch (e) {
                        DebugLog.log('‚ùå Silent buffer play failed: ' + (e && e.message));
                    }
                }
                
                // Continue with original timing for visual effects
                setTimeout(function() {
                    try {
                        if (document.documentElement.requestFullscreen) {
                            DebugLog.log('Requesting fullscreen...');
                            document.documentElement.requestFullscreen().then(function() {
                                DebugLog.log('‚úÖ Fullscreen activated successfully');
                            }).catch(function(e) {
                                DebugLog.log('‚ùå Fullscreen request rejected: ' + e.message);
                            });
                        } else if (document.documentElement.webkitRequestFullscreen) {
                            DebugLog.log('Requesting webkit fullscreen...');
                            document.documentElement.webkitRequestFullscreen();
                        } else if (document.documentElement.mozRequestFullScreen) {
                            DebugLog.log('Requesting moz fullscreen...');
                            document.documentElement.mozRequestFullScreen();
                        } else {
                            DebugLog.log('‚ùå No fullscreen API available');
                        }
                    } catch (e) {
                        DebugLog.log('‚ùå Fullscreen request failed: ' + e.message);
                    }
                    
                    UI.hideElement('preInitOverlay');
                    UI.showElement('initOverlay');
                    
                    SG1.startInitialization();
                }, 300);
            },

            startInitialization: function() {
                DebugLog.log('Starting logo animation sequence');
                
                var logo = document.querySelector('.init-logo');
                var status = UI.element('statusText');
                
                if (status) status.textContent = 'Audio system ready. Loading voice...';
                
                if (logo) {
                    logo.style.opacity = '0';
                    logo.style.animation = 'none';
                    logo.style.transform = 'translate(-50%, -50%) scale(0.8)';
                    
                    setTimeout(function() {
                        if (status) {
                            status.textContent = 'Voice system online. Starting sequence...';
                            // Fade out after 2 seconds
                            setTimeout(function() {
                                status.style.transition = 'opacity 1s ease-out';
                                status.style.opacity = '0';
                            }, 2000);
                        }
                        
                        DebugLog.log('Starting SG1 logo animation');
                        logo.style.animation = 'sg1LogoFade 13s ease-in-out forwards';
                        
                        // Backup visibility check
                        setTimeout(function() {
                            if (logo.style.opacity === '0') {
                                DebugLog.log('Logo backup: forcing visibility');
                                logo.style.opacity = '1';
                                logo.style.transform = 'translate(-50%, -50%) scale(1)';
                                
                                setTimeout(function() {
                                    logo.style.opacity = '0';
                                }, 8000);
                            }
                        }, 3000);
                        
                        setTimeout(function() {
                            logo.style.opacity = '0';
                            logo.style.display = 'none';
                        }, 12000);
                        
                    }, 1000);
                } else {
                    DebugLog.log('ERROR: Logo element not found');
                }
                
                setTimeout(function() {
                    if (status) status.textContent = 'Loading neural interface...';
                    DebugLog.log('Showing DNA visualizer');
                    UI.showElement('visualizer');
                    // Gentle fade in DNA
                    var visualizer = UI.element('visualizer');
                    if (visualizer) {
                        visualizer.style.opacity = '0';
                        visualizer.style.transition = 'opacity 4s ease-in';
                        setTimeout(function() {
                            visualizer.style.opacity = '1';
                        }, 100);
                    }
                    // --- Move mobile audio playback here, after DNA fade-in starts ---
                    var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                    if (isMobile && !State.mobileAudioStarted) {
                        DebugLog.log('üö® MOBILE: Delaying audio playback until DNA visualizer is visible...');
                        setTimeout(function() {
                            DebugLog.log('üéµ NOW ATTEMPTING MOBILE AUDIO PLAYBACK (after DNA fade-in)...');
                            var mobileVoiceAudio = new Audio(State.audioFiles[0]);
                            DebugLog.log('üéµ Audio object created, URL: ' + State.audioFiles[0]);
                            mobileVoiceAudio.volume = 1.0;
                            mobileVoiceAudio.addEventListener('loadstart', function() { DebugLog.log('üì° Audio: Loading started'); });
                            mobileVoiceAudio.addEventListener('loadeddata', function() { DebugLog.log('üì° Audio: Data loaded'); });
                            mobileVoiceAudio.addEventListener('canplay', function() { DebugLog.log('üì° Audio: Can play'); });
                            mobileVoiceAudio.addEventListener('error', function(e) { DebugLog.log('üö® Audio Error Event: ' + e.message); });
                            var playPromise = mobileVoiceAudio.play();
                            DebugLog.log('üéµ Play promise created: ' + (playPromise ? 'YES' : 'NO'));
                            if (playPromise) {
                                playPromise.then(function() {
                                    DebugLog.log('‚úÖ SUCCESS: Mobile audio started!');
                                    State.isSpeaking = true;
                                    State.step = 0;
                                    State.mobileAudioStarted = true;
                                    UI.setVisualizerState('speaking');
                                    mobileVoiceAudio.onended = function() {
                                        DebugLog.log('üèÅ Mobile audio ended');
                                        State.isSpeaking = false;
                                        UI.setVisualizerState('active');
                                        setTimeout(function() { UI.showBereitButton(); }, 1000);
                                    };
                                }).catch(function(e) {
                                    DebugLog.log('üö® MOBILE AUDIO FAILED:');
                                    DebugLog.log('Error name: ' + e.name);
                                    DebugLog.log('Error message: ' + e.message);
                                    DebugLog.log('Error code: ' + (e.code || 'none'));
                                    setTimeout(function() { UI.showBereitButton(); }, 1000);
                                });
                            } else {
                                DebugLog.log('üö® No play promise returned!');
                            }
                        }, 4100); // Wait for DNA fade-in (4s) before playing audio
                    }
                }, 14000); // DNA appears at 14s (6s after logo ends at 8s - no overlap)

                setTimeout(function() {
                    if (status) status.textContent = 'Ready to begin...';
                    UI.hideElement('initOverlay');
                    setTimeout(function() {
                        Conversation.startQ1();
                    }, 500);
                }, 17000); // Voice starts at 17s (back to original timing)
            },

            init: function() {
                DebugLog.init();
                DebugLog.log('=== SG1 SYSTEM INIT ===');
                // Speech synthesis fully removed
                DebugLog.log('SG1 System ready');
            }
        };

        // Initialize when DOM is ready
        /*
        function __forceDebugLogInit() {
            if (!window.__DEBUGLOG_INIT && window.DebugLog && typeof DebugLog.init === 'function') {
                DebugLog.init();
            }
        }
        */
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                SG1.init();
                // setTimeout(__forceDebugLogInit, 1000);
            });
        } else {
            SG1.init();
            // setTimeout(__forceDebugLogInit, 1000);
        }

        /*
        // Re-append debug textarea after fullscreen is requested to ensure visibility (COMMENTED OUT)
        function ensureDebugLogAfterFullscreen() {
            if (window.DebugLog && typeof DebugLog.ensureTextArea === 'function') {
                DebugLog.ensureTextArea();
                if (DebugLog.textArea && DebugLog.textArea.parentNode !== document.body) {
                    document.body.appendChild(DebugLog.textArea);
                }
                DebugLog.textArea.style.zIndex = '2147483647';
                DebugLog.textArea.style.display = 'block';
            }
        }
        document.addEventListener('fullscreenchange', ensureDebugLogAfterFullscreen);
        document.addEventListener('webkitfullscreenchange', ensureDebugLogAfterFullscreen);
        document.addEventListener('mozfullscreenchange', ensureDebugLogAfterFullscreen);
        document.addEventListener('MSFullscreenChange', ensureDebugLogAfterFullscreen);
        */

        // Global error handler
        window.onerror = function(message, source, lineno, colno, error) {
            DebugLog.log('ERROR: ' + message + ' at line ' + lineno);
            if (error && error.stack) {
                DebugLog.log('STACK: ' + error.stack);
            }
            return false;
        };
//# sourceURL=SG1-working.html
</script>
</body>
</html>